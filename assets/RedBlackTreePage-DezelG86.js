import{j as s,m as Ze,c as et,C as He,s as vt,t as kt,p as We,n as tt,o as ze,d as qe,X as _e,P as Ke,S as Nt,B as wt,e as jt,f as yt,I as Xe,T as St,h as Ct,i as $t,k as Rt,l as It,g as Tt,u as _t,U as zt,R as Bt,v as Ht}from"./vendor-ui-KJSjU0aj.js";import{r as p}from"./vendor-react-CTD4pAUy.js";import{v as Pt}from"./v4-EwEgHOG0.js";import{S as Vt}from"./SEO-Dqlw7WXN.js";import{S as G,C as Ge,P as Et}from"./PlaybackControls-Dnmiext_.js";import{C as Dt,P as Ft}from"./PrerequisiteBanner-DS4sYztf.js";import{u as st}from"./index-Cxz-I9Lq.js";class ve{id;value;color;left;right;parent;x=0;y=0;constructor(l,t="red"){this.id=Pt(),this.value=l,this.color=t,this.left=null,this.right=null,this.parent=null}clone(){const l=new ve(this.value,this.color);return l.id=this.id,this.left&&(l.left=this.left.clone(),l.left.parent=l),this.right&&(l.right=this.right.clone(),l.right.parent=l),l}}class Lt{root;steps;deletionStrategy;constructor(l="successor"){this.root=null,this.steps=[],this.deletionStrategy=l}getSnapshot(){return this.root?this.root.clone():null}clear(){this.root=null,this.steps=[]}find(l){let t=this.root;for(;t;){if(l===t.value)return t;l<t.value?t=t.left:t=t.right}return null}getNode(l){return this.find(l)}addStep(l,t,i=[]){this.steps.push({type:l,message:t,targetIds:i,payload:{snapshot:this.getSnapshot()}})}leftRotate(l){const t=l.right;l.right=t.left,t.left&&(t.left.parent=l),t.parent=l.parent,l.parent?l===l.parent.left?l.parent.left=t:l.parent.right=t:this.root=t,t.left=l,l.parent=t,this.addStep("move",`Left rotation: node ${l.value} rotated with node ${t.value}`,[t.id,l.id])}rightRotate(l){const t=l.left;l.left=t.right,t.right&&(t.right.parent=l),t.parent=l.parent,l.parent?l===l.parent.left?l.parent.left=t:l.parent.right=t:this.root=t,t.right=l,l.parent=t,this.addStep("move",`Right rotation: node ${l.value} rotated with node ${t.value}`,[t.id,l.id])}insert(l){this.steps=[];const t=new ve(l,"red");if(!this.root)return t.color="black",this.root=t,this.addStep("insert",`Inserted root ${l} (Black)`,[t.id]),this.steps;let i=this.root,o=null;for(;i;)if(o=i,l<i.value)i=i.left;else if(l>i.value)i=i.right;else return this.addStep("error",`Value ${l} already exists`,[i.id]),this.steps;return t.parent=o,l<o.value?o.left=t:o.right=t,this.addStep("insert",`Inserted ${l} (Red)`,[t.id]),this.insertFixup(t),this.addStep("complete",`Insertion of ${l} complete`),this.steps}insertFixup(l){let t=l;for(;t.parent&&t.parent.color==="red";){const i=t.parent.parent;if(!i)break;if(t.parent===i.left){const o=i.right;o&&o.color==="red"?(this.addStep("highlight",`Case 3: Uncle ${o.value} is Red - Recoloring nodes ${t.parent.value}, ${o.value}, ${i.value}`,[t.parent.id,o.id,i.id]),t.parent.color="black",o.color="black",i.color="red",this.addStep("move",`Recolored: Parent ${t.parent.value}â†’Black, Uncle ${o.value}â†’Black, Grandparent ${i.value}â†’Red`,[t.parent.id,o.id,i.id]),t=i):(t===t.parent.right&&(t=t.parent,this.addStep("highlight",`Case 4: Triangle (LR) - Left rotate node ${t.value}`,[t.id]),this.leftRotate(t)),this.addStep("highlight",`Case 5: Line (LL) - Operating on nodes ${t.parent.value} and ${i.value}`,[t.parent.id,i.id]),t.parent.color="black",i.color="red",this.addStep("move",`Recolored: Node ${t.parent.value}â†’Black, Node ${i.value}â†’Red`,[t.parent.id,i.id]),this.rightRotate(i))}else{const o=i.left;o&&o.color==="red"?(this.addStep("highlight",`Case 3 (Mirror): Uncle ${o.value} is Red - Recoloring nodes ${t.parent.value}, ${o.value}, ${i.value}`,[t.parent.id,o.id,i.id]),t.parent.color="black",o.color="black",i.color="red",this.addStep("move",`Recolored: Parent ${t.parent.value}â†’Black, Uncle ${o.value}â†’Black, Grandparent ${i.value}â†’Red`,[t.parent.id,o.id,i.id]),t=i):(t===t.parent.left&&(t=t.parent,this.addStep("highlight",`Case 4 (Mirror): Triangle (RL) - Right rotate node ${t.value}`,[t.id]),this.rightRotate(t)),this.addStep("highlight",`Case 5 (Mirror): Line (RR) - Operating on nodes ${t.parent.value} and ${i.value}`,[t.parent.id,i.id]),t.parent.color="black",i.color="red",this.addStep("move",`Recolored: Node ${t.parent.value}â†’Black, Node ${i.value}â†’Red`,[t.parent.id,i.id]),this.leftRotate(i))}}this.root.color==="red"&&(this.root.color="black",this.addStep("move",`Root node ${this.root.value} recolored to black`,[this.root.id]))}validate(){const l=[];return this.root&&(this.root.color==="red"&&l.push({type:"root-red",nodeIds:[this.root.id],message:"Root must be black"}),this.checkRedRed(this.root,l),this.checkBlackHeight(this.root,l)),l}checkRedRed(l,t){l&&(l.color==="red"&&(l.left&&l.left.color==="red"&&t.push({type:"red-red",nodeIds:[l.id,l.left.id],message:"Red node cannot have Red child"}),l.right&&l.right.color==="red"&&t.push({type:"red-red",nodeIds:[l.id,l.right.id],message:"Red node cannot have Red child"})),this.checkRedRed(l.left,t),this.checkRedRed(l.right,t))}checkBlackHeight(l,t){if(!l)return 1;const i=this.checkBlackHeight(l.left,t),o=this.checkBlackHeight(l.right,t);return i!==o&&i!==-1&&o!==-1?(t.push({type:"black-height",nodeIds:[l.id],message:`Black height mismatch: L=${i}, R=${o}`}),-1):i===-1||o===-1?-1:i+(l.color==="black"?1:0)}insertManual(l){if(this.steps=[],this.findNode(this.root,l))return this.addStep("error",`Value ${l} already exists in the tree`),this.steps;const t=new ve(l,"red");if(!this.root)return this.root=t,this.addStep("insert",`Inserted root ${l} (Red) - Violation!`,[t.id]),this.steps;this._insertBST(this.root,t),this.addStep("insert",`Inserted ${l} (Red)`,[t.id]);const i=this.validate();return i.length>0&&this.addStep("error",`Violations found: ${i.map(o=>o.type).join(", ")}`,i.flatMap(o=>o.nodeIds)),this.steps}_insertBST(l,t){t.value<l.value?l.left?this._insertBST(l.left,t):(l.left=t,t.parent=l):l.right?this._insertBST(l.right,t):(l.right=t,t.parent=l)}toggleColor(l){this.steps=[];const t=this.getNodeById(l);return t&&(t.color=t.color==="red"?"black":"red",this.addStep("move",`Toggled node ${t.value} to ${t.color}`,[t.id])),this.steps}rotateNode(l,t){this.steps=[];const i=this.findNode(this.root,l);if(!i)return this.steps;if(t==="left"){if(!i.right)return this.addStep("error","Cannot rotate left: No right child",[i.id]),this.steps;this.leftRotate(i)}else{if(!i.left)return this.addStep("error","Cannot rotate right: No left child",[i.id]),this.steps;this.rightRotate(i)}return this.steps}findNode(l,t){return l?l.value===t?l:t<l.value?this.findNode(l.left,t):this.findNode(l.right,t):null}getNodeById(l){return this._getNodeById(this.root,l)}_getNodeById(l,t){return l?l.id===t?l:this._getNodeById(l.left,t)||this._getNodeById(l.right,t):null}delete(l){this.steps=[];let t=this.root;for(;t;)if(l<t.value)t=t.left;else if(l>t.value)t=t.right;else break;if(!t)return this.addStep("error",`Value ${l} not found`),this.steps;this.addStep("highlight",`Found node ${l} to delete`,[t.id]);let i=t,o=i.color,g,f;return t.left?t.right?(this.deletionStrategy==="predecessor"?(i=this.maximum(t.left),this.addStep("highlight",`Replace with predecessor (max of left subtree): ${i.value}`,[i.id,t.id])):(i=this.minimum(t.right),this.addStep("highlight",`Replace with successor (min of right subtree): ${i.value}`,[i.id,t.id])),o=i.color,this.deletionStrategy==="predecessor"?(g=i.left,i.parent===t?f=i:(f=i.parent,this.transplant(i,i.left),i.left=t.left,i.left&&(i.left.parent=i)),this.transplant(t,i),i.right=t.right,i.right&&(i.right.parent=i),i.color=t.color):(g=i.right,i.parent===t?f=i:(f=i.parent,this.transplant(i,i.right),i.right=t.right,i.right&&(i.right.parent=i)),this.transplant(t,i),i.left=t.left,i.left&&(i.left.parent=i),i.color=t.color)):(g=t.left,f=t.parent,this.transplant(t,t.left)):(g=t.right,f=t.parent,this.transplant(t,t.right)),o==="black"&&this.deleteFixup(g,g?g.parent:f),this.addStep("complete",`Deletion of ${l} complete`),this.steps}deleteManual(l){this.steps=[];let t=this.root;for(;t;)if(l<t.value)t=t.left;else if(l>t.value)t=t.right;else break;if(!t)return this.addStep("error",`Value ${l} not found`),{steps:this.steps,needsFixup:!1,fixupParentId:null,fixupIsLeft:null,deletedWasBlack:!1};this.addStep("highlight",`Found node ${l} to delete`,[t.id]);let i=t,o=i.color,g,f,v=null;t.left?t.right?(this.deletionStrategy==="predecessor"?(i=this.maximum(t.left),this.addStep("highlight",`Replace with predecessor (max of left subtree): ${i.value}`,[i.id,t.id])):(i=this.minimum(t.right),this.addStep("highlight",`Replace with successor (min of right subtree): ${i.value}`,[i.id,t.id])),o=i.color,this.deletionStrategy==="predecessor"?(g=i.left,i.parent===t?(f=i,v=!0):(f=i.parent,v=i.parent?i===i.parent.left:null,this.transplant(i,i.left),i.left=t.left,i.left&&(i.left.parent=i)),this.transplant(t,i),i.right=t.right,i.right&&(i.right.parent=i),i.color=t.color):(g=i.right,i.parent===t?(f=i,v=!1):(f=i.parent,v=i.parent?i===i.parent.left:null,this.transplant(i,i.right),i.right=t.right,i.right&&(i.right.parent=i)),this.transplant(t,i),i.left=t.left,i.left&&(i.left.parent=i),i.color=t.color),this.addStep("delete",`Replaced ${t.value} with ${i.value}`,[i.id])):(g=t.left,f=t.parent,v=t.parent?t===t.parent.left:null,this.transplant(t,t.left),this.addStep("delete",`Removed node ${l} (no right child)`,[])):(g=t.right,f=t.parent,v=t.parent?t===t.parent.left:null,this.transplant(t,t.right),this.addStep("delete",`Removed node ${l} (no left child)`,[]));const O=o==="black";return O?this.addStep("error",`Black node deleted - fixup required! Double-black at ${g?`node ${g.value}`:"NIL position"}`,f?[f.id]:[]):o==="red"?this.addStep("complete","Deletion complete - deleted node was Red, no fixup needed"):g&&g.color==="red"&&this.addStep("highlight",`Node ${g.value} should be recolored to Black to restore balance`,[g.id]),{steps:this.steps,needsFixup:O,fixupParentId:f?.id||null,fixupIsLeft:v,deletedWasBlack:o==="black"}}transplant(l,t){l.parent?l===l.parent.left?l.parent.left=t:l.parent.right=t:this.root=t,t&&(t.parent=l.parent)}minimum(l){for(;l.left;)l=l.left;return l}maximum(l){for(;l.right;)l=l.right;return l}deleteFixup(l,t){for(;(!l||l.color==="black")&&l!==this.root;)if(t?.left===l){let o=t.right;o&&o.color==="red"&&(this.addStep("highlight",`Fixup Case 1: Sibling ${o.value} is Red, operating on nodes ${o.value} and ${t.value}`,[o.id,t.id]),o.color="black",t.color="red",this.leftRotate(t),o=t.right),(!o?.left||o.left.color==="black")&&(!o?.right||o.right.color==="black")?(this.addStep("highlight",`Fixup Case 2: Sibling ${o?o.value:"null"} is Black with Black nephews`,[o?o.id:t.id]),o&&(o.color="red"),l=t,t=l?.parent||null):((!o?.right||o.right.color==="black")&&(this.addStep("highlight",`Fixup Case 3: Close nephew is Red - Rotate sibling ${o.value}`,[o.id]),o?.left&&(o.left.color="black"),o&&(o.color="red"),this.rightRotate(o),o=t.right),this.addStep("highlight",`Fixup Case 4: Far nephew is Red - Rotate parent ${t.value}`,[t.id]),o&&(o.color=t.color,o.right&&(o.right.color="black")),t.color="black",this.leftRotate(t),l=this.root,t=null)}else{let o=t.left;o&&o.color==="red"&&(this.addStep("highlight",`Fixup Case 1 (Mirror): Sibling ${o.value} is Red, operating on nodes ${o.value} and ${t.value}`,[o.id,t.id]),o.color="black",t.color="red",this.rightRotate(t),o=t.left),(!o?.right||o.right.color==="black")&&(!o?.left||o.left.color==="black")?(this.addStep("highlight",`Fixup Case 2 (Mirror): Sibling ${o?o.value:"null"} is Black with Black nephews`,[o?o.id:t.id]),o&&(o.color="red"),l=t,t=l?.parent||null):((!o?.left||o.left.color==="black")&&(this.addStep("highlight",`Fixup Case 3 (Mirror): Close nephew is Red - Rotate sibling ${o.value}`,[o.id]),o?.right&&(o.right.color="black"),o&&(o.color="red"),this.leftRotate(o),o=t.left),this.addStep("highlight",`Fixup Case 4 (Mirror): Far nephew is Red - Rotate parent ${t.value}`,[t.id]),o&&(o.color=t.color,o.left&&(o.left.color="black")),t.color="black",this.rightRotate(t),l=this.root,t=null)}l&&(l.color="black")}}const Y=25,Be=({node:e,x:l,y:t,level:i,highlightedIds:o=[],selectedId:g,onNodeClick:f,onNodeDrag:v,pulsingId:O,violations:W=[],onMouseEnter:X,onMouseLeave:B})=>{const[L,M]=p.useState(!1),R=o.includes(e.id),J=g===e.id,C=e.color==="red",N=O===e.id,j=!!v,A=W.filter(x=>x.nodeIds.includes(e.id)),I=A.length>0,z=A[0]?.type,H=p.useRef(!1),w=()=>{H.current=!0},T=(x,k)=>{const _=k.offset.x;Math.abs(_)>30&&v&&v(e,_>0?"right":"left"),setTimeout(()=>{H.current=!1},50)},P=x=>{x.stopPropagation(),H.current||f?.(e)};return s.jsxs(s.Fragment,{children:[s.jsxs(Ze.div,{initial:{left:l-Y,top:t-Y},animate:{left:l-Y,top:t-Y},transition:{duration:.3,ease:"easeOut"},onClick:P,onMouseEnter:()=>{M(!0),X?.()},onMouseLeave:()=>{M(!1),B?.()},drag:j?"x":!1,dragConstraints:{left:0,right:0,top:0,bottom:0},dragElastic:.2,dragSnapToOrigin:!0,onDragStart:w,onDragEnd:T,className:`absolute flex items-center justify-center border-2 rounded-full shadow-md z-20 font-bold select-none text-white no-pan transition-transform
          ${J?"ring-4 ring-blue-400 border-blue-500":R?"ring-4 ring-amber-400 border-amber-500":C?"border-red-600":"border-slate-800"}
          ${C?"bg-red-500":"bg-slate-900"}
          ${I?"ring-4 ring-red-500/50 animate-pulse":""}
          ${N?"animate-bounce ring-4 ring-green-400":""}
          ${j?"cursor-grab active:cursor-grabbing":"cursor-pointer"}
        `,style:{width:Y*2,height:Y*2,touchAction:"none"},children:[j&&L&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"absolute -left-8 top-1/2 -translate-y-1/2 text-blue-500 opacity-70 animate-pulse",children:s.jsx(et,{size:18})}),s.jsx("div",{className:"absolute -right-8 top-1/2 -translate-y-1/2 text-blue-500 opacity-70 animate-pulse",children:s.jsx(He,{size:18})})]}),e.value,I&&s.jsxs("div",{className:"absolute -top-3 -right-3 z-30 group",children:[s.jsx("div",{className:"bg-red-600 text-white text-[8px] px-1.5 py-0.5 rounded-full border border-white shadow-sm whitespace-nowrap cursor-help",children:z==="red-red"?"é•è¦":z==="root-red"?"æ ¹":"é»‘é«˜"}),s.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-50",children:[s.jsxs("div",{className:"bg-slate-900 text-white text-[10px] px-3 py-2 rounded-lg shadow-xl whitespace-nowrap",children:[z==="red-red"&&s.jsxs("span",{children:["âš ï¸ ",s.jsx("b",{children:"ç´…ç´…é•è¦"}),"ï¼šç´…è‰²ç¯€é»žä¸èƒ½æœ‰ç´…è‰²å­ç¯€é»ž"]}),z==="root-red"&&s.jsxs("span",{children:["âš ï¸ ",s.jsx("b",{children:"æ ¹ç¯€é»žé•è¦"}),"ï¼šæ ¹ç¯€é»žå¿…é ˆæ˜¯é»‘è‰²"]}),z==="black-height"&&s.jsxs("span",{children:["âš ï¸ ",s.jsx("b",{children:"é»‘é«˜é•è¦"}),"ï¼šè·¯å¾‘ä¸Šçš„é»‘è‰²ç¯€é»žæ•¸é‡ä¸ä¸€è‡´"]})]}),s.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900"})]})]})]},e.id),e.left&&s.jsxs(s.Fragment,{children:[s.jsx(Ye,{parentX:l,parentY:t,childX:e.left.x,childY:e.left.y,childColor:e.left.color,hasError:W.some(x=>x.type==="red-red"&&x.nodeIds.includes(e.id)&&x.nodeIds.includes(e.left.id))}),s.jsx(Be,{node:e.left,x:e.left.x,y:e.left.y,level:i+1,highlightedIds:o,selectedId:g,onNodeClick:f,onNodeDrag:v,pulsingId:O,violations:W,onMouseEnter:X,onMouseLeave:B})]}),e.right&&s.jsxs(s.Fragment,{children:[s.jsx(Ye,{parentX:l,parentY:t,childX:e.right.x,childY:e.right.y,childColor:e.right.color,hasError:W.some(x=>x.type==="red-red"&&x.nodeIds.includes(e.id)&&x.nodeIds.includes(e.right.id))}),s.jsx(Be,{node:e.right,x:e.right.x,y:e.right.y,level:i+1,highlightedIds:o,selectedId:g,onNodeClick:f,onNodeDrag:v,pulsingId:O,violations:W,onMouseEnter:X,onMouseLeave:B})]})]})},Ye=({parentX:e,parentY:l,childX:t,childY:i,childColor:o,hasError:g})=>{const f=g||o==="red"?"#ef4444":"#cbd5e1";return s.jsx("svg",{className:"absolute top-0 left-0 w-px h-px overflow-visible pointer-events-none z-10",children:s.jsx(Ze.line,{initial:{x1:e,y1:l+Y,x2:t,y2:i-Y},animate:{x1:e,y1:l+Y,x2:t,y2:i-Y},transition:{duration:.3,ease:"easeOut"},stroke:f,strokeWidth:g?"4":"2",className:g?"animate-pulse opacity-50":""})})};function Mt({manifest:e,structureId:l,structure:t,onReset:i,onUpdateView:o}){const[g,f]=p.useState("menu"),[v,O]=p.useState(0),[W,X]=p.useState(0),[B,L]=p.useState([]),[M,R]=p.useState(""),[J,C]=p.useState(null),N=`ds-playground-${l}-max-level`,j=`ds-playground-${l}-completed-lessons`;p.useEffect(()=>{const w=localStorage.getItem(N);w&&X(parseInt(w));const T=localStorage.getItem(j);if(T)try{L(JSON.parse(T))}catch{L([])}},[N,j]);const A=p.useCallback(w=>{w<0||w>=e.length||(O(w),f("lesson"),R(""),C(null),i(),e[w].setup(t),o&&o())},[e,t,i,o]),I=p.useCallback(w=>{const T=w||e[v].id;if(!B.includes(T)){const x=[...B,T];L(x),localStorage.setItem(j,JSON.stringify(x))}const P=v+1;P>W&&(X(P),localStorage.setItem(N,P.toString()))},[v,W,B,e,N,j]),z=p.useCallback(()=>{const w=e[v];if(w.type!=="quiz"||w.answer===void 0)return;const T=parseInt(M);!isNaN(T)&&T===w.answer?(C("correct"),I()):C("wrong")},[e,v,M,I]),H=p.useCallback(()=>{localStorage.removeItem(N),localStorage.removeItem(j),X(0),L([])},[N,j]);return{view:g,setView:f,lessonIndex:v,currentLesson:e[v],maxUnlocked:W,completedLessons:B,quizInput:M,setQuizInput:R,quizFeedback:J,runLesson:A,completeLesson:I,checkQuiz:z,resetProgress:H}}const At=[{id:1,nameKey:"phase1",icon:"ðŸ“š"},{id:2,nameKey:"phase2",icon:"âž•"},{id:3,nameKey:"phase3",icon:"âž–"},{id:4,nameKey:"phase4",icon:"ðŸŽ“"}];function Ut({view:e,setView:l,lessonIndex:t,currentLesson:i,maxUnlocked:o,manifest:g,completedLessons:f,runLesson:v,resetProgress:O,completeLesson:W,quizInput:X,setQuizInput:B,checkQuiz:L,quizFeedback:M,i18nNamespace:R,onFinish:J,renderExtraContent:C}){const{t:N}=st([R,"common"]),[j,A]=p.useState(!1),[I,z]=p.useState([1]),H=p.useMemo(()=>{const k={1:[],2:[],3:[],4:[]};return g.forEach((_,F)=>{const Z=_.phase||1;k[Z].push({lesson:_,idx:F})}),k},[g]),w=(k,_)=>k.unlockCondition?k.unlockCondition(f):_<=o,T=k=>(H[k]||[]).some(({lesson:F,idx:Z})=>w(F,Z)),P=k=>{z(_=>_.includes(k)?_.filter(F=>F!==k):[..._,k])};if(e==="menu")return s.jsxs("div",{className:"space-y-3 animate-in fade-in",children:[s.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl border border-slate-700",children:[s.jsx("h3",{className:"text-white font-bold mb-1 text-sm",children:N(`${R}:tutorial.title`)}),s.jsx("p",{className:"text-[10px] text-slate-400",children:N(`${R}:tutorial.welcome`)})]}),At.map(k=>{const _=H[k.id]||[],F=T(k.id),Z=I.includes(k.id),pe=_.filter(({lesson:q})=>f.includes(q.id)).length;return s.jsxs("div",{className:`border rounded-xl overflow-hidden ${F?"border-slate-700":"border-slate-800 opacity-60"}`,children:[s.jsxs("button",{onClick:()=>P(k.id),disabled:!F,className:`w-full flex items-center justify-between p-3 transition-colors ${F?"bg-slate-800 hover:bg-slate-700":"bg-slate-900 cursor-not-allowed"}`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{children:k.icon}),s.jsx("span",{className:`text-xs font-bold uppercase ${F?"text-white":"text-slate-600"}`,children:N(`${R}:tutorial.phases.${k.nameKey}`)}),s.jsxs("span",{className:"text-[10px] text-slate-500",children:["(",pe,"/",_.length,")"]})]}),F?Z?s.jsx(vt,{size:14,className:"text-slate-400"}):s.jsx(He,{size:14,className:"text-slate-400"}):s.jsx(kt,{size:12,className:"text-slate-600"})]}),Z&&F&&s.jsx("div",{className:"p-2 bg-slate-900/50 grid grid-cols-2 gap-2",children:_.map(({lesson:q,idx:ae})=>{const ee=w(q,ae),de=f.includes(q.id);return s.jsxs("button",{onClick:()=>ee&&v(ae),disabled:!ee,className:`p-2 rounded-lg border text-left transition-all ${ee?de?"bg-green-900/20 border-green-700/50 hover:bg-green-900/30":"bg-slate-800 border-slate-700 hover:bg-slate-700 hover:border-blue-500/50":"bg-slate-900 border-slate-800 opacity-50 cursor-not-allowed"}`,children:[s.jsxs("div",{className:"flex justify-between items-start mb-1",children:[s.jsx("span",{className:`text-[9px] font-black uppercase px-1 py-0.5 rounded ${ee?de?"bg-green-500/20 text-green-400":"bg-blue-600 text-white":"bg-slate-800 text-slate-600"}`,children:q.type==="concept"?"ðŸ“–":q.type==="quiz"?"â“":q.type==="challenge"?"âš¡":"ðŸŽ¯"}),de&&s.jsx(We,{size:12,className:"text-green-500"}),!ee&&s.jsx("span",{className:"text-slate-600 text-[10px]",children:"ðŸ”’"})]}),s.jsx("div",{className:`text-[10px] font-bold leading-tight ${ee?"text-slate-300":"text-slate-600"}`,children:N(`${R}:tutorial.levels.${q.id}.title`)})]},q.id)})})]},k.id)}),f.length>0&&s.jsxs("button",{onClick:()=>{if(!j){A(!0),setTimeout(()=>A(!1),3e3);return}O(),A(!1)},className:`w-full py-2 mt-2 text-[10px] font-bold rounded-xl transition-colors uppercase tracking-widest flex items-center justify-center gap-2 border ${j?"bg-red-600 border-red-600 text-white animate-pulse":"border-transparent text-red-400 hover:text-red-300 hover:bg-red-900/20 hover:border-red-900/30"}`,children:[s.jsx(tt,{size:12})," ",j?"Confirm Reset?":"Reset Progress"]})]});const x=f.includes(i.id);return s.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx("button",{onClick:()=>l("menu"),className:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-white transition-colors",children:s.jsx(et,{size:16})}),s.jsxs("span",{className:"text-xs font-black text-slate-500 uppercase tracking-widest",children:[i.type==="concept"?"ðŸ“–":i.type==="quiz"?"â“":i.type==="challenge"?"âš¡":"ðŸŽ¯"," ",N(`${R}:tutorial.levels.${i.id}.title`)]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(G,{text:N(`${R}:tutorial.levels.${i.id}.desc`),className:"text-slate-400 text-sm"}),C&&C(),i.type==="quiz"&&!x&&s.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-slate-700 space-y-3",children:[s.jsx("p",{className:"text-sm font-bold text-slate-300",children:N(`${R}:tutorial.levels.${i.id}.question`,{val:i.targetVal,defaultValue:"What is the value?"})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"number",value:X,onChange:k=>B(k.target.value),onKeyDown:k=>k.key==="Enter"&&L(),className:"flex-1 bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-white font-mono text-center outline-none focus:border-blue-500",placeholder:"?"}),s.jsx("button",{onClick:L,className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs uppercase hover:bg-blue-500",children:"SUBMIT"})]}),M==="correct"&&s.jsxs("div",{className:"text-green-400 text-xs font-bold flex items-center gap-1",children:[s.jsx(ze,{size:12})," Correct!"]}),M==="wrong"&&s.jsx("div",{className:"text-red-400 text-xs font-bold",children:"Incorrect, try again."})]})]}),s.jsxs("div",{className:"flex flex-col gap-2 pt-4 border-t border-slate-800",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>v(t),className:"flex-1 py-2.5 bg-slate-800 text-slate-400 rounded-xl text-[10px] font-bold uppercase hover:bg-slate-700 transition-colors",children:N("common:reset","Reset")}),i.type==="concept"&&!x&&s.jsx("button",{onClick:()=>W(),className:"flex-[2] py-2.5 bg-blue-600 text-white rounded-xl text-[10px] font-bold uppercase flex items-center justify-center gap-2 hover:bg-blue-500 shadow-lg shadow-blue-900/20",children:N("common:iUnderstand","I Understand âœ“")}),x&&t<g.length-1&&s.jsxs("button",{onClick:()=>v(t+1),className:"flex-[2] py-2.5 bg-green-600 text-white rounded-xl text-[10px] font-bold uppercase flex items-center justify-center gap-2 hover:bg-green-500 shadow-lg shadow-green-900/20",children:[N("common:next","Next Level")," ",s.jsx(ze,{size:14})]}),x&&t===g.length-1&&s.jsxs("button",{onClick:J,className:"flex-[2] py-2.5 bg-blue-600 text-white rounded-xl text-[10px] font-bold uppercase flex items-center justify-center gap-2 hover:bg-blue-500 shadow-lg shadow-blue-900/20",children:[N("common:finish","Finish")," ",s.jsx(We,{size:14})]})]}),x&&t<g.length-1&&s.jsx("button",{onClick:()=>l("menu"),className:"w-full py-2 text-slate-500 text-[10px] font-bold uppercase hover:text-slate-300 transition-colors",children:N("common:backToMenu","â† Back to Menu")})]})]})}const K=(e,l)=>e.every(t=>l.includes(t)),Q=(e,l)=>e.filter(t=>l.includes(t)).length,re=["insert_case0","insert_case1_1","insert_case1_2","insert_case2_1","insert_case2_2","insert_case3_1","insert_case3_2","insert_challenge"],Qe=["delete_red_leaf","delete_red_replacement","delete_case1","delete_case2","delete_case3","delete_case4","delete_challenge"],Je=[{id:"basics",type:"concept",phase:1,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15)},allowHintToggle:!1},{id:"colors",type:"concept",phase:1,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15),e.insert(3),e.insert(7)},unlockCondition:e=>K(["basics"],e),allowHintToggle:!1},{id:"black_height",type:"concept",phase:1,setup:e=>{e.clear(),e.insert(20),e.insert(10),e.insert(30),e.insert(5),e.insert(15),e.insert(25),e.insert(35)},unlockCondition:e=>K(["basics","colors"],e),allowHintToggle:!1},{id:"rotations",type:"guided",phase:1,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15),e.insert(3)},check:e=>e.validate().length===0,unlockCondition:e=>K(["basics","colors","black_height"],e),allowHintToggle:!0},{id:"foundation_quiz",type:"quiz",phase:1,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15)},answer:2,unlockCondition:e=>K(["basics","colors","black_height","rotations"],e),allowHintToggle:!1},{id:"insert_case0",type:"concept",phase:2,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15)},check:e=>e.find(3)!==null&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!1},{id:"insert_case1_1",type:"guided",phase:2,setup:e=>{e.clear(),e.insert(30),e.insert(20),e.insert(40),e.root&&(e.root.color="black"),e.getNode(20)&&(e.getNode(20).color="black"),e.getNode(40)&&(e.getNode(40).color="black"),e.insert(10),e.insert(25),e.getNode(10)&&(e.getNode(10).color="red"),e.getNode(25)&&(e.getNode(25).color="red")},check:e=>e.find(5)!==null&&e.getNode(20)?.color==="red"&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!0},{id:"insert_case1_2",type:"guided",phase:2,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15),e.root&&(e.root.color="black"),e.root?.left&&(e.root.left.color="red"),e.root?.right&&(e.root.right.color="red")},check:e=>e.find(1)!==null&&e.root?.color==="black"&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!0},{id:"insert_case2_1",type:"guided",phase:2,setup:e=>{e.clear(),e.insert(20),e.insert(15),e.insert(25),e.root&&(e.root.color="black"),e.getNode(15)&&(e.getNode(15).color="black"),e.getNode(25)&&(e.getNode(25).color="black"),e.insert(10),e.getNode(10)&&(e.getNode(10).color="red")},check:e=>e.find(5)!==null&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!0},{id:"insert_case2_2",type:"guided",phase:2,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15),e.root&&(e.root.color="black"),e.getNode(5)&&(e.getNode(5).color="black"),e.getNode(15)&&(e.getNode(15).color="black"),e.insert(20),e.getNode(20)&&(e.getNode(20).color="red")},check:e=>e.find(25)!==null&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!0},{id:"insert_case3_1",type:"guided",phase:2,setup:e=>{e.clear(),e.insert(20),e.insert(10),e.insert(25),e.root&&(e.root.color="black"),e.getNode(10)&&(e.getNode(10).color="black"),e.getNode(25)&&(e.getNode(25).color="black"),e.insert(5),e.getNode(5)&&(e.getNode(5).color="red")},check:e=>e.find(7)!==null&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!0},{id:"insert_case3_2",type:"guided",phase:2,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(20),e.root&&(e.root.color="black"),e.getNode(5)&&(e.getNode(5).color="black"),e.getNode(20)&&(e.getNode(20).color="black"),e.insert(25),e.getNode(25)&&(e.getNode(25).color="red")},check:e=>e.find(22)!==null&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!0},{id:"insert_challenge",type:"challenge",phase:2,setup:e=>{e.clear()},check:e=>[20,10,30,5,4,40,35].every(i=>e.find(i)!==null)&&e.validate().length===0,unlockCondition:e=>Q(re.slice(0,7),e)>=6,allowHintToggle:!1},{id:"delete_red_leaf",type:"guided",phase:3,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15),e.root&&(e.root.color="black"),e.getNode(5)&&(e.getNode(5).color="red"),e.getNode(15)&&(e.getNode(15).color="red")},check:e=>e.find(5)===null&&e.validate().length===0,unlockCondition:e=>Q(re.slice(0,7),e)>=5,allowHintToggle:!0},{id:"delete_red_replacement",type:"guided",phase:3,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15),e.insert(2),e.root&&(e.root.color="black"),e.getNode(5)&&(e.getNode(5).color="black"),e.getNode(15)&&(e.getNode(15).color="black"),e.getNode(2)&&(e.getNode(2).color="red")},check:e=>e.find(5)===null&&e.validate().length===0,unlockCondition:e=>Q(re.slice(0,6),e)>=3,allowHintToggle:!0},{id:"delete_case1",type:"guided",phase:3,setup:e=>{e.clear(),e.insert(20),e.insert(10),e.insert(30),e.insert(25),e.insert(35),e.root&&(e.root.color="black"),e.getNode(10)&&(e.getNode(10).color="black"),e.getNode(30)&&(e.getNode(30).color="red"),e.getNode(25)&&(e.getNode(25).color="black"),e.getNode(35)&&(e.getNode(35).color="black")},check:e=>e.find(10)===null&&e.validate().length===0,unlockCondition:e=>Q(re.slice(0,6),e)>=3,allowHintToggle:!0},{id:"delete_case2",type:"guided",phase:3,setup:e=>{e.clear(),e.insert(20),e.insert(10),e.insert(30),e.root&&(e.root.color="black"),e.getNode(10)&&(e.getNode(10).color="black"),e.getNode(30)&&(e.getNode(30).color="black")},check:e=>e.find(10)===null&&e.validate().length===0,unlockCondition:e=>Q(re.slice(0,6),e)>=3,allowHintToggle:!0},{id:"delete_case3",type:"guided",phase:3,setup:e=>{e.clear(),e.insert(20),e.insert(10),e.insert(30),e.insert(25),e.root&&(e.root.color="black"),e.getNode(10)&&(e.getNode(10).color="black"),e.getNode(30)&&(e.getNode(30).color="black"),e.getNode(25)&&(e.getNode(25).color="red")},check:e=>e.find(10)===null&&e.validate().length===0,unlockCondition:e=>Q(re.slice(0,6),e)>=3,allowHintToggle:!0},{id:"delete_case4",type:"guided",phase:3,setup:e=>{e.clear(),e.insert(20),e.insert(10),e.insert(30),e.insert(35),e.root&&(e.root.color="black"),e.getNode(10)&&(e.getNode(10).color="black"),e.getNode(30)&&(e.getNode(30).color="black"),e.getNode(35)&&(e.getNode(35).color="red")},check:e=>e.find(10)===null&&e.validate().length===0,unlockCondition:e=>Q(re.slice(0,6),e)>=3,allowHintToggle:!0},{id:"delete_challenge",type:"challenge",phase:3,setup:e=>{e.clear(),e.insert(50),e.insert(25),e.insert(75),e.insert(10),e.insert(30),e.insert(60),e.insert(85),e.insert(5),e.insert(15)},check:e=>e.find(25)===null&&e.find(75)===null&&e.validate().length===0,unlockCondition:e=>Q(Qe.slice(0,6),e)>=3,allowHintToggle:!1},{id:"final_challenge",type:"challenge",phase:4,setup:e=>{e.clear(),e.insert(40),e.insert(20),e.insert(60),e.insert(10),e.insert(30),e.insert(50),e.insert(70)},check:e=>e.find(5)!==null&&e.find(25)!==null&&e.find(10)===null&&e.validate().length===0,unlockCondition:e=>Q(Qe.slice(0,6),e)>=3,allowHintToggle:!1},{id:"graduation",type:"concept",phase:4,setup:e=>{e.clear(),e.insert(42)},unlockCondition:e=>K(["final_challenge"],e),allowHintToggle:!1}],Qt=()=>{const{t:e}=st(["common","rbtree"],{useSuspense:!1}),[l]=p.useState(()=>new Lt),[t,i]=p.useState(null),[o,g]=p.useState("auto"),[f,v]=p.useState([]),[O,W]=p.useState(null),[X,B]=p.useState(!1),[L,M]=p.useState("concept"),[R,J]=p.useState(window.innerWidth>768),[C,N]=p.useState("logs"),[j,A]=p.useState([]),[I,z]=p.useState(-1),[H,w]=p.useState([]),[T,P]=p.useState(-1),[x,k]=p.useState(!1),[_,F]=p.useState(1),[Z,pe]=p.useState([]),[q,ae]=p.useState(null),[ee,de]=p.useState("info"),[ne,ke]=p.useState(!1),[te,ge]=p.useState(-1),fe=n=>te===n?`z-[10001] relative ring-4 ring-yellow-400 ${n===0?"":"shadow-[0_0_0_9999px_rgba(0,0,0,0.7)]"}`:"",[Ne,we]=p.useState(null),[xe,lt]=p.useState("successor"),[it,ce]=p.useState(!1),[Pe,U]=p.useState(null),[je,ye]=p.useState(null),[ot,Se]=p.useState(!1),V=Mt({manifest:Je,structureId:"rb",structure:l,onReset:()=>{l.root=null,i(null),v([]),E(null),le(null),A([{id:"init",action:"Lesson Start",steps:[],finalSnapshot:null}]),z(0),w([]),P(-1),g("manual")},onUpdateView:()=>{i(me(l.root)),v(l.validate())}});p.useEffect(()=>{if(C==="tutorial"&&V.view==="lesson"&&!x){const n=V.currentLesson;n.type==="concept"&&o!=="auto"?g("auto"):(n.type==="guided"||n.type==="challenge")&&o!=="manual"&&g("manual"),(n.type==="guided"||n.type==="challenge")&&n.check&&n.check(l)&&l.validate().length===0&&V.completeLesson()}},[I,l,V,C,x,o]),p.useEffect(()=>{C==="tutorial"&&V.view==="lesson"&&ce(!1)},[V.lessonIndex,C,V.view]);const[m,E]=p.useState(null),[se,le]=p.useState(null),[Ce,ue]=p.useState(""),$e=p.useRef(null);p.useEffect(()=>{l.deletionStrategy=xe},[xe,l]);const[rt,nt]=p.useState(320),[be,Ve]=p.useState(!1),[at,Ee]=p.useState(!1),dt=()=>Ve(!0),De=()=>Ve(!1),Fe=n=>{if(be){const r=n.clientX;r>=280&&r<600&&nt(r)}};p.useEffect(()=>(window.addEventListener("mousemove",Fe),window.addEventListener("mouseup",De),()=>{window.removeEventListener("mousemove",Fe),window.removeEventListener("mouseup",De)}),[be]),p.useEffect(()=>{I===-1&&(A([{id:"init",action:"Initial",steps:[],finalSnapshot:null}]),z(0))},[]),p.useEffect(()=>{if(ne){const n=setTimeout(()=>ke(!1),3e3);return()=>clearTimeout(n)}},[ne]),p.useEffect(()=>{const n=localStorage.getItem("ds-playground-rbtree-help-seen")==="true";n||(B(!0),localStorage.setItem("ds-playground-rbtree-help-seen","true"));const r=localStorage.getItem("ds-playground-rbtree-max-level");!(localStorage.getItem("ds-playground-rbtree-completed")==="true")&&!r&&!n&&N("tutorial")},[]);const me=n=>{if(!n)return null;const r=new Map,a=c=>{if(!c)return 0;const S=a(c.left),$=a(c.right),y=Math.max(60,S+$+40);return r.set(c.id,y),y};a(n);let d=0;const u=(c,S)=>{c&&(u(c.left,S+1),c.x=d*60,c.y=S*80,d++,u(c.right,S+1))};u(n,0);const h=n.x,b=c=>{c&&(c.x-=h,b(c.left),b(c.right))};return b(n),n},ie=(n,r)=>{oe(),w(r),P(0);const a=r.length>0&&r[r.length-1].payload?.snapshot?r[r.length-1].payload.snapshot:l.getSnapshot(),d=j.slice(0,I+1);d.push({id:Math.random().toString(36),action:n,steps:r,finalSnapshot:a}),A(d),z(d.length-1),Re(r.length)},Re=(n,r=0)=>{k(!0);let a=r;const d=()=>{a<n-1?(a++,P(a),$e.current=setTimeout(d,800/_)):k(!1)};d()},oe=()=>{$e.current&&clearTimeout($e.current),k(!1)},ct=n=>{oe(),n>=0&&n<H.length&&P(n)};p.useEffect(()=>{if(H.length>0&&T>=0){const n=H[T];if(n.payload?.snapshot!==void 0){const r=n.payload.snapshot;i(me(r))}pe(n.targetIds||[]),ae(n.message||null),de(n.type||"info")}},[T,H,o]),p.useEffect(()=>{o==="manual"&&!x?v(l.validate()):o==="auto"&&v([])},[I,o,l,t,x]);const Le=()=>{const n=Ce.split(",").map(r=>parseInt(r.trim())).filter(r=>!isNaN(r));if(n.length>0)if(o==="auto"){const r=[];n.forEach(a=>{const d=l.insert(a);r.push(...d)}),ie(`Batch Insert ${n.join(", ")}`,r),ue("")}else{const r=n[0],a=l.insertManual(r);ie(`Insert ${r}`,a),n.length>1?ue(n.slice(1).join(",")):ue("")}},ut=n=>{if(!x)if(o==="manual"){if(m&&m.steps.length>0){const r=m.steps.findIndex(a=>!a.isCompleted&&!a.isSkipped&&a.action==="recolor"&&a.nodeValue===n.value);if(r!==-1){ie(`Toggle Color ${n.value}`,l.toggleColor(n.id));const a=[...m.steps];a[r]={...a[r],isCompleted:!0};const d=a.findIndex(u=>!u.isCompleted&&!u.isSkipped);E({...m,steps:a,currentStepIndex:d===-1?a.length:d});return}else{if(m.steps.some(h=>(h.isCompleted||h.isSkipped)&&h.action==="recolor"&&h.nodeValue===n.value)){U(`${e("rbtree:guide.alreadyDone")}`),setTimeout(()=>U(null),3e3);return}const d=m.steps.filter(h=>!h.isCompleted&&!h.isSkipped),u=d.length>0?d.map(h=>h.action==="recolor"?`${e("rbtree:guide.clickNode")} ${h.nodeValue}`:`${e("rbtree:guide.dragNode")} ${h.nodeValue}`).join(" "+e("common:or")+" "):e("rbtree:guide.allStepsComplete");U(`${e("rbtree:guide.wrongAction")} ${e("rbtree:guide.expected")}: ${u}`),setTimeout(()=>U(null),3e3);return}}ie(`Toggle Color ${n.value}`,l.toggleColor(n.id))}else we(n)},ht=(n,r)=>{if(!x&&o==="manual"){if(m&&m.steps.length>0){const a=m.steps.findIndex(d=>!d.isCompleted&&!d.isSkipped&&d.action==="rotate"&&d.nodeValue===n.value&&d.direction===r);if(a!==-1){if(m.steps.some(b=>!b.isCompleted&&!b.isSkipped&&b.action==="recolor")){U(e("rbtree:guide.performRecolorFirst")),setTimeout(()=>U(null),3e3);return}ie(`Rotate ${r} ${n.value}`,l.rotateNode(n.value,r));const u=[...m.steps];u[a]={...u[a],isCompleted:!0};const h=u.findIndex(b=>!b.isCompleted&&!b.isSkipped);E({...m,steps:u,currentStepIndex:h===-1?u.length:h});return}else{const d=m.steps.findIndex(c=>!c.isCompleted&&!c.isSkipped&&c.action==="rotate"&&c.nodeValue===n.value&&c.direction!==r);if(d!==-1){const c=m.steps[d];U(`${e("rbtree:guide.wrongDirection")} ${e("rbtree:guide.expected")}: ${c.direction==="left"?e("common:left"):e("common:right")}`),setTimeout(()=>U(null),3e3);return}if(m.steps.some(c=>(c.isCompleted||c.isSkipped)&&c.action==="rotate"&&c.nodeValue===n.value)){U(`${e("rbtree:guide.alreadyDone")}`),setTimeout(()=>U(null),3e3);return}const h=m.steps.filter(c=>!c.isCompleted&&!c.isSkipped),b=h.length>0?h.map(c=>c.action==="recolor"?`${e("rbtree:guide.clickNode")} ${c.nodeValue}`:`${e("rbtree:guide.dragNode")} ${c.nodeValue}`).join(" "+e("common:or")+" "):e("rbtree:guide.allStepsComplete");U(`${e("rbtree:guide.wrongAction")} ${e("rbtree:guide.expected")}: ${b}`),setTimeout(()=>U(null),3e3);return}}ie(`Rotate ${r} ${n.value}`,l.rotateNode(n.value,r))}},pt=()=>{const n=Ne?Ne.value:parseInt(Ce);if(!isNaN(n)){if(o==="manual"){const r=l.deleteManual(n);if(ie(`Delete ${n}`,r.steps),r.needsFixup&&r.fixupParentId){const a={parentId:r.fixupParentId,isLeftChild:r.fixupIsLeft,needsFixup:!0};le(a),setTimeout(()=>{if(l.validate().length===0){le(null);return}const u=he(a);u?(E(u),ce(!1)):le(null)},100)}else r.deletedWasBlack&&r.needsFixup,le(null),E(null)}else ie(`Delete ${n}`,l.delete(n));ue(""),we(null)}},he=n=>{if(!n||!n.needsFixup||!n.parentId)return null;const r=l.getNodeById(n.parentId);if(!r)return null;const a=n.isLeftChild,d=a?r.right:r.left,u=a?r.left:r.right,h=[];let b="";const c=y=>!y||y.color==="black",S=y=>y?.color==="red",$=(y,D,Te)=>{const Oe=Te?.color===D;h.push({action:"recolor",nodeValue:y,targetColor:D,description:`${y} â†’ ${e(D==="black"?"common:black":"common:red")}`,isSkipped:Oe,skipReason:Oe?e("rbtree:guide.alreadyCorrectColor",{val:y,color:e(D==="black"?"common:black":"common:red")}):void 0})};if(!r)return null;if(u&&S(u))return b=e("rbtree:guide.deleteSimpleCase"),$(u.value,"black",u),{caseType:b,steps:h,currentStepIndex:0,originalViolationNodeIds:u?[u.id]:[]};if(!d)return null;if(S(d))b=e("rbtree:guide.deleteCase1"),$(d.value,"black",d),$(r.value,"red",r),h.push({action:"rotate",nodeValue:r.value,direction:a?"left":"right",description:e("rbtree:guide.dragToRotate",{val:r.value,dir:e(a?"common:left":"common:right")})});else{const y=a?d.left:d.right,D=a?d.right:d.left;c(y)&&c(D)?(b=e("rbtree:guide.deleteCase2"),$(d.value,"red",d),S(r)&&$(r.value,"black",r)):S(y)&&c(D)?(b=e("rbtree:guide.deleteCase3"),$(y.value,"black",y),$(d.value,"red",d),h.push({action:"rotate",nodeValue:d.value,direction:a?"right":"left",description:e("rbtree:guide.dragToRotate",{val:d.value,dir:e(a?"common:right":"common:left")})})):S(D)&&(b=e("rbtree:guide.deleteCase4"),$(d.value,r.color,d),$(r.value,"black",r),$(D.value,"black",D),h.push({action:"rotate",nodeValue:r.value,direction:a?"left":"right",description:e("rbtree:guide.dragToRotate",{val:r.value,dir:e(a?"common:left":"common:right")})}))}return h.length===0?null:{caseType:b,steps:h,currentStepIndex:0,originalViolationNodeIds:[r.id]}},gt=()=>{if(I<=0||x)return;oe();const n=I-1,r=j[n];l.root=r.finalSnapshot?r.finalSnapshot.clone():null,i(me(l.root)),w(r.steps),P(r.steps.length>0?r.steps.length-1:-1),z(n)},ft=()=>{if(I>=j.length-1||x)return;oe();const n=I+1,r=j[n];z(n),w(r.steps),P(0),Re(r.steps.length)},xt=()=>{if(!ne){ke(!0);return}ke(!1),x&&oe(),l.root=null,i(null),A([{id:"init",action:"Cleared",steps:[],finalSnapshot:null}]),z(0),w([]),P(-1),pe([]),ae(null),we(null),ce(!1),ye(null),E(null)},bt=()=>{if(f.length===0)return null;const n=f.filter(a=>{if(a.type==="root-red")return l.root&&l.root.color==="red";if(a.type==="red-red"){const d=l.getNodeById(a.nodeIds[0]),u=a.nodeIds[1]?l.getNodeById(a.nodeIds[1]):null;return!(!d||d.color!=="red"||u&&u.color!=="red"||u&&d.left!==u&&d.right!==u)}if(a.type==="black-height"){const d=l.getNodeById(a.nodeIds[0]);if(!d)return!1;const u=c=>{if(!c)return 1;const S=u(c.left),$=u(c.right);return S===-1||$===-1||S!==$?-1:S+(c.color==="black"?1:0)},h=u(d.left),b=u(d.right);return h===-1||b===-1||h!==b}return!0});if(n.length===0)return null;const r=n.find(a=>a.type==="root-red");if(r)return r;if(je){const a=n.find(d=>d.nodeIds.includes(je));if(a)return a}return n[0]},Ie=()=>{const n=bt();if(!n)return null;const r=[];let a="";if(n.type==="root-red"){const d=l.root;if(!d)return null;a=e("rbtree:guide.caseRootRed"),r.push({action:"recolor",nodeValue:d.value,targetColor:"black",description:e("rbtree:guide.actionRootRed",{val:d.value})})}else if(n.type==="red-red"){const d=n.nodeIds[0],u=n.nodeIds[1],h=l.getNodeById(d),b=u?l.getNodeById(u):null,c=h?.parent;if(!h||!b||!c)return null;const S=h===c.left?c.right:c.left;if(S?.color==="red")a=e("rbtree:guide.caseUncleRed"),r.push({action:"recolor",nodeValue:h.value,targetColor:"black",description:`${h.value} â†’ ${e("common:black")}`}),S&&r.push({action:"recolor",nodeValue:S.value,targetColor:"black",description:`${S.value} â†’ ${e("common:black")}`}),c===l.root?r.push({action:"recolor",nodeValue:c.value,targetColor:"red",description:`${c.value} â†’ ${e("common:red")}`,isSkipped:!0,skipReason:e("rbtree:guide.skippedRootStaysBlack")}):r.push({action:"recolor",nodeValue:c.value,targetColor:"red",description:`${c.value} â†’ ${e("common:red")}`});else{const y=h===c.left&&b===h.left,D=h===c.right&&b===h.right,Te=h===c.left&&b===h.right,Ue=h===c.right&&b===h.left;D?(a=e("rbtree:guide.caseRRBlack"),r.push({action:"recolor",nodeValue:h.value,targetColor:"black",description:`${h.value} â†’ ${e("common:black")}`}),r.push({action:"recolor",nodeValue:c.value,targetColor:"red",description:`${c.value} â†’ ${e("common:red")}`}),r.push({action:"rotate",nodeValue:c.value,direction:"left",description:e("rbtree:guide.dragToRotate",{val:c.value,dir:e("common:left")})})):y?(a=e("rbtree:guide.caseLLBlack"),r.push({action:"recolor",nodeValue:h.value,targetColor:"black",description:`${h.value} â†’ ${e("common:black")}`}),r.push({action:"recolor",nodeValue:c.value,targetColor:"red",description:`${c.value} â†’ ${e("common:red")}`}),r.push({action:"rotate",nodeValue:c.value,direction:"right",description:e("rbtree:guide.dragToRotate",{val:c.value,dir:e("common:right")})})):Te?(a=e("rbtree:guide.caseLRBlack"),r.push({action:"rotate",nodeValue:h.value,direction:"left",description:e("rbtree:guide.dragToRotate",{val:h.value,dir:e("common:left")})})):Ue&&(a=e("rbtree:guide.caseRLBlack"),r.push({action:"rotate",nodeValue:h.value,direction:"right",description:e("rbtree:guide.dragToRotate",{val:h.value,dir:e("common:right")})}))}}else if(n.type==="black-height"){const d=l.getNodeById(n.nodeIds[0]);if(!d)return null;const u=$=>{if(!$)return 1;const y=u($.left),D=u($.right);return y===-1||D===-1||y!==D?-1:y+($.color==="black"?1:0)},h=u(d.left),b=u(d.right);let c=!1;if(h!==-1&&b!==-1)if(h<b)c=!0;else if(b<h)c=!1;else return null;else return null;const S={needsFixup:!0,parentId:d.id,isLeftChild:c};return he(S)}return r.length===0?null:{caseType:a,steps:r,currentStepIndex:0,originalViolationNodeIds:n.nodeIds}},Me=()=>{if(o!=="manual")return null;if(f.length===0)return m&&E(null),je&&ye(null),se&&le(null),null;if(x)return null;if(!it){const r=m&&m.steps.length>0,a=m?m.steps.filter(u=>u.isCompleted||u.isSkipped).length:0,d=se?.needsFixup;return s.jsx("button",{onClick:()=>{if(!m||m.steps.every(u=>u.isCompleted||u.isSkipped))if(d&&se){const u=he(se);u&&E(u)}else{const u=Ie();u&&E(u)}ce(!0)},className:"w-full py-3 mb-6 bg-amber-500/10 border-2 border-dashed border-amber-500/30 rounded-2xl text-amber-500 font-black text-[10px] uppercase tracking-widest animate-pulse hover:bg-amber-500/20 transition-colors",children:r?`${e("rbtree:guide.showHint")} (${a}/${m.steps.length})`:e(d?"rbtree:guide.showHintDelete":"rbtree:guide.showHint")})}if(!m){if(se?.needsFixup){const a=he(se);if(a)return E(a),null}const r=Ie();return r&&E(r),null}if(m.steps.every(r=>r.isCompleted||r.isSkipped)){if(l.validate().length===0)return E(null),le(null),ye(null),null;if(se?.needsFixup){const d=he(se);if(d)return E(d),null}const a=Ie();return a&&E(a),null}return s.jsxs("div",{className:"bg-amber-950/50 border border-amber-500/30 p-4 rounded-xl text-amber-50 mb-6 relative group shadow-2xl animate-in slide-in-from-top-2",children:[s.jsx("button",{onClick:()=>{ce(!1)},className:"absolute top-2 right-2 p-1 text-amber-500/50 hover:text-amber-500 transition-colors",children:s.jsx(_e,{size:14})}),s.jsxs("div",{className:"flex flex-col gap-1 mb-4 border-b border-amber-700/50 pb-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-amber-500/80 text-[9px] uppercase tracking-widest font-bold",children:[s.jsx(Xe,{size:14}),s.jsx("span",{children:e("rbtree:guide.currentSituation")})]}),s.jsx("div",{className:"text-base font-black text-amber-400 leading-tight",children:m.caseType}),s.jsxs("div",{className:"text-[10px] text-amber-500/60 font-mono",children:[e("rbtree:guide.wikiReference"),": ",m.caseType]})]}),s.jsx("div",{className:"space-y-2",children:m.steps.map((r,a)=>{const d=r.isCompleted,u=r.isSkipped,h=!d&&!u;return s.jsx("div",{className:`p-3 rounded-lg border transition-all ${u?"bg-slate-800/20 border-slate-700/20 opacity-60":d?"bg-green-900/20 border-green-700/30":"bg-amber-500/10 border-amber-500/30 ring-1 ring-amber-500/20"}`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${u?"bg-slate-700 text-slate-400":d?"bg-green-600 text-white":"bg-slate-800 border-2 border-amber-500/50 text-amber-500"}`,children:u?"â€”":d?s.jsx(Ht,{size:14,strokeWidth:4}):a+1}),s.jsxs("div",{className:`flex-1 ${d||u?"opacity-80":""}`,children:[r.action==="recolor"?s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:h?"text-amber-200 font-bold":"text-slate-400 line-through decoration-slate-600",children:e("rbtree:guide.clickToRecolor")}),s.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[s.jsx("span",{className:"font-mono font-bold",children:r.nodeValue}),s.jsx("span",{className:"text-slate-500",children:"â†’"}),s.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold ${r.targetColor==="black"?"bg-slate-900 text-white border border-slate-600":"bg-red-600 text-white"}`,children:r.targetColor==="black"?e("common:black"):e("common:red")})]})]}):s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:h?"text-amber-200 font-bold":"text-slate-400 line-through decoration-slate-600",children:e("rbtree:guide.dragToRotateLabel")}),s.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[s.jsx("span",{className:"text-white",children:e("rbtree:guide.dragNode")}),s.jsx("span",{className:"font-mono font-bold text-amber-200",children:r.nodeValue}),s.jsx("span",{className:"text-white",children:e("rbtree:guide.toThe")}),s.jsx("span",{className:`font-bold ${r.direction==="left"?"text-blue-400":"text-green-400"}`,children:r.direction==="left"?e("common:left"):e("common:right")})]})]}),s.jsxs("div",{className:"mt-2 flex gap-2",children:[u&&r.skipReason&&s.jsx("span",{className:"text-[10px] bg-slate-800 text-slate-400 px-1.5 py-0.5 rounded border border-slate-700",children:r.skipReason}),d&&!u&&s.jsx("span",{className:"text-[10px] bg-green-900/40 text-green-400 px-1.5 py-0.5 rounded border border-green-800/50",children:e("rbtree:guide.completedStep")})]})]})]})},a)})}),m.steps.filter(a=>!a.isCompleted&&!a.isSkipped).length===0?s.jsx("div",{className:"mt-4 pt-3 border-t border-green-700/30",children:s.jsxs("div",{className:"text-[10px] uppercase tracking-widest text-green-400 mb-2 font-bold",children:["âœ“ ",e("rbtree:guide.allStepsComplete")]})}):s.jsxs("div",{className:"mt-4 pt-3 border-t border-amber-700/30",children:[s.jsxs("div",{className:"text-[10px] uppercase tracking-widest text-amber-400 mb-2 font-bold animate-pulse",children:["ðŸ‘† ",e("rbtree:guide.currentAction")]}),s.jsx("div",{className:"text-xs text-amber-200/60",children:e("rbtree:guide.performAnyPending")})]})]})},Ae=()=>{if(te===-1)return null;const n=[{title:e("rbtree:guide.ui.mode"),pos:"top-34 left-88"},{title:e("rbtree:guide.ui.sidebar"),pos:"top-1/2 left-80"},{title:e("rbtree:guide.ui.canvas"),pos:"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},{title:e("rbtree:guide.ui.action"),pos:"bottom-26 left-88"},{title:e("rbtree:guide.ui.timeline"),pos:"bottom-26 right-80"}],r=n[te];return r?s.jsxs("div",{className:`fixed ${r.pos} z-[10002] bg-slate-900 text-white p-4 rounded-xl shadow-2xl max-w-xs animate-in zoom-in-95 border border-slate-700`,children:[s.jsx("h4",{className:"font-bold mb-3 text-sm leading-relaxed",children:r.title}),s.jsxs("div",{className:"flex gap-2 justify-end",children:[s.jsx("button",{onClick:()=>ge(-1),className:"text-slate-400 hover:text-white text-[10px] font-bold px-2 uppercase tracking-wider",children:"Exit"}),te>0&&s.jsx("button",{onClick:()=>ge(te-1),className:"bg-slate-800 hover:bg-slate-700 text-slate-300 px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase tracking-wider",children:"Prev"}),s.jsx("button",{onClick:()=>ge(te<n.length-1?te+1:-1),className:"bg-blue-600 hover:bg-blue-500 text-white px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase tracking-wider",children:te<n.length-1?"Next":"Finish"})]})]}):null},mt=()=>{const n=V.currentLesson,r=f.length>0?s.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 p-3 rounded-xl animate-pulse mb-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-red-400 font-bold text-xs uppercase mb-1",children:[s.jsx(qe,{size:14})," Attention"]}),s.jsx("div",{className:"text-red-300 text-xs",children:f.map((d,u)=>s.jsx("div",{children:d.message},u))})]}):null,a=n?.allowHintToggle?s.jsx("div",{className:"mt-2 text-slate-300 text-xs leading-relaxed font-mono",children:Me()}):null;return s.jsxs("div",{children:[r,a]})};return s.jsxs("div",{className:`h-full w-full flex bg-slate-100 overflow-hidden relative font-sans text-slate-900 ${be?"cursor-col-resize select-none":""}`,children:[s.jsx(Vt,{title:"Red-Black Tree Visualization",description:"Interactive Red-Black Tree visualization. Understand how color properties and rotations maintain balance.",keywords:["Red-Black Tree","RB Tree","Balanced Binary Search Tree","Visualization","Algorithm"]}),s.jsx("style",{children:be?"* { transition: none !important; cursor: col-resize !important; user-select: none !important; }":""}),Pe&&s.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 z-[10000] bg-amber-500 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 border border-amber-400 animate-in fade-in slide-in-from-top-4",children:[s.jsx(qe,{size:20,className:"shrink-0"}),s.jsx("span",{className:"font-bold",children:Pe}),s.jsx(_e,{size:18,onClick:()=>U(null),className:"cursor-pointer hover:bg-white/20 rounded-full"})]}),s.jsxs("div",{style:{width:R?window.innerWidth>768?`${rt}px`:"100%":"0px"},className:`h-full flex flex-col bg-slate-900 border-r border-slate-800 shrink-0 z-[100] shadow-2xl relative ${R?"":"overflow-hidden"} ${window.innerWidth<=768?"fixed left-0 top-0":"relative"} ${fe(1)}`,children:[window.innerWidth<=768&&R&&s.jsx("button",{onClick:()=>J(!1),className:"absolute top-4 right-4 text-white z-[110]",children:s.jsx(Ke,{size:24})}),s.jsxs("div",{className:"flex flex-col h-full w-full",children:[s.jsxs("div",{className:"flex p-2 gap-1 bg-slate-950/50",children:[s.jsxs("button",{onClick:()=>N("logs"),className:`flex-1 py-2 rounded-lg flex items-center justify-center gap-2 text-[9px] sm:text-[10px] font-black uppercase transition-all ${C==="logs"?"bg-blue-600 text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:[s.jsx(Nt,{size:14}),s.jsx("span",{className:"hidden sm:inline",children:"Logs"})]}),s.jsxs("button",{onClick:()=>N("wiki"),className:`flex-1 py-2 rounded-lg flex items-center justify-center gap-2 text-[9px] sm:text-[10px] font-black uppercase transition-all ${C==="wiki"?"bg-amber-500 text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:[s.jsx(wt,{size:14}),s.jsx("span",{className:"hidden sm:inline",children:"Wiki"})]}),s.jsxs("button",{onClick:()=>{N("tutorial"),V.setView("menu")},className:`flex-1 py-2 rounded-lg flex items-center justify-center gap-2 text-[9px] sm:text-[10px] font-black uppercase transition-all ${C==="tutorial"?"bg-green-600 text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:[s.jsx(jt,{size:14}),s.jsx("span",{className:"hidden sm:inline",children:"Course"})]})]}),s.jsxs("div",{className:"flex-grow overflow-y-auto p-4 font-mono text-[10px] text-slate-300 custom-scrollbar",children:[C==="logs"&&s.jsxs("div",{className:"space-y-2",children:[Me(),s.jsx("h3",{className:"text-slate-500 font-black uppercase tracking-[0.2em] mb-4",children:"History"}),j.slice(1).reverse().map((n,r)=>s.jsxs("button",{onClick:()=>{oe();const a=j.length-1-r;l.root=n.finalSnapshot?n.finalSnapshot.clone():null,i(me(n.finalSnapshot)),w(n.steps),P(n.steps.length-1),z(a)},className:`w-full text-left p-3 rounded-xl border transition-all ${I===j.length-1-r?"bg-blue-600/20 border-blue-500/50 text-blue-100 shadow-inner":"bg-slate-800/30 border-slate-700/50 hover:bg-slate-800 text-slate-400"}`,children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"font-black uppercase tracking-wider",children:n.action}),s.jsxs("span",{className:"opacity-40 text-[8px]",children:[n.steps.length," steps"]})]}),s.jsx("div",{className:"text-[9px] opacity-60 truncate",children:n.steps[n.steps.length-1]?.message})]},n.id))]}),C==="wiki"&&s.jsxs("div",{className:"space-y-8 font-sans pb-12 text-slate-400",children:[s.jsx("h3",{className:"text-white font-black text-xs uppercase tracking-[0.3em]",children:"Knowledge Base"}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-cyan-400 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.concept")}),s.jsx(G,{text:e("rbtree:wiki.conceptDesc")})]}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-slate-300 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.nilNodes")}),s.jsx(G,{text:e("rbtree:wiki.nilNodesDesc")})]}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-indigo-400 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.properties")}),s.jsx(G,{text:e("rbtree:wiki.propertiesDesc")})]}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-blue-400 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.blackHeight")}),s.jsx(G,{text:e("rbtree:wiki.blackHeightDesc")})]}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-emerald-400 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.insertion")}),s.jsx(G,{text:e("rbtree:wiki.insertionDesc")})]}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-rose-400 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.deletion")}),s.jsx(G,{text:e("rbtree:wiki.deletionDesc")})]}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-purple-400 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.complexity")}),s.jsx(G,{text:e("rbtree:wiki.complexityDesc")})]})]}),C==="tutorial"&&s.jsx(Ut,{...V,manifest:Je,i18nNamespace:"rbtree",onFinish:()=>Se(!0),renderExtraContent:mt})]})]}),R&&window.innerWidth>768&&s.jsx("div",{onMouseDown:dt,className:"absolute right-0 top-0 w-1.5 h-full cursor-col-resize z-[120] hover:bg-blue-500/50"})]}),s.jsxs("div",{className:"flex-grow flex flex-col min-w-0 h-full relative bg-white",children:[s.jsxs("div",{className:"flex-grow relative overflow-hidden bg-grid-slate-100",children:[s.jsx("button",{onClick:()=>J(!R),className:"absolute bottom-6 left-6 z-30 w-10 h-10 bg-slate-900 text-white rounded-2xl shadow-xl flex items-center justify-center hover:scale-110 active:scale-90 transition-all",children:R?s.jsx(Ke,{size:20}):s.jsx(yt,{size:20})}),s.jsxs("div",{className:`absolute top-6 left-6 z-20 pointer-events-none flex flex-col gap-2 ${fe(0)}`,children:[s.jsxs("div",{className:"flex gap-2 pointer-events-auto",children:[s.jsx("button",{onClick:()=>g("auto"),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase transition-all ${o==="auto"?"bg-blue-600 text-white shadow-lg":"bg-white/50 text-slate-500 hover:bg-white"}`,children:"Auto"}),s.jsx("button",{onClick:()=>g("manual"),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase transition-all ${o==="manual"?"bg-amber-500 text-white shadow-lg":"bg-white/50 text-slate-500 hover:bg-white"}`,children:"Manual"})]}),V.view==="lesson"&&C==="tutorial"&&s.jsxs("div",{className:"bg-white/80 backdrop-blur-md px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase text-slate-500 shadow-sm border border-slate-200 pointer-events-auto",children:["Level ",V.lessonIndex,": ",e(`rbtree:tutorial.levels.${V.currentLesson.id}.title`)]}),q&&s.jsxs("div",{className:`${ee==="error"?"bg-red-600/90 border-red-400":"bg-blue-600/90 border-blue-400"} backdrop-blur-md px-4 py-2 rounded-2xl text-white shadow-lg border flex items-center gap-2 animate-in slide-in-from-left-4`,children:[s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-white animate-pulse shrink-0"}),s.jsx("span",{className:"text-xs font-black uppercase tracking-wider",children:q})]})]}),s.jsx("button",{onClick:()=>B(!0),className:"absolute top-6 right-6 w-10 h-10 bg-white/80 backdrop-blur-md border border-slate-200 rounded-2xl flex items-center justify-center text-slate-400 hover:text-blue-600 shadow-sm z-20",children:s.jsx(Xe,{size:20})}),s.jsx(St,{initialScale:1,minScale:.1,maxScale:2,centerOnInit:!0,panning:{disabled:at,excluded:["no-pan"]},children:({zoomIn:n,zoomOut:r,resetTransform:a})=>s.jsxs(s.Fragment,{children:[s.jsx(Ct,{wrapperStyle:{width:"100%",height:"100%"},children:s.jsx("div",{className:"w-[4000px] h-[4000px] relative cursor-grab active:cursor-grabbing",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",style:{overflow:"visible"},children:t&&s.jsx(Be,{node:t,x:t.x,y:t.y,level:0,highlightedIds:Z,selectedId:Ne?.id,onNodeClick:ut,onNodeDrag:o==="manual"?ht:void 0,pulsingId:O,violations:f,onMouseEnter:()=>Ee(!0),onMouseLeave:()=>Ee(!1)})})})}),s.jsxs("div",{className:"absolute bottom-6 right-6 z-20 flex flex-col gap-2",children:[s.jsx("button",{onClick:()=>n(),className:"w-10 h-10 bg-white shadow-sm border border-slate-200 rounded-xl flex items-center justify-center text-slate-600 hover:bg-white active:scale-90",children:s.jsx($t,{size:20})}),s.jsx("button",{onClick:()=>r(),className:"w-10 h-10 bg-white shadow-sm border border-slate-200 rounded-xl flex items-center justify-center text-slate-600 hover:bg-white active:scale-90",children:s.jsx(Rt,{size:20})}),s.jsx("button",{onClick:()=>a(),className:"w-10 h-10 bg-blue-600 text-white rounded-xl flex items-center justify-center shadow-lg active:scale-90 mt-2",children:s.jsx(It,{size:20})})]}),Ae()]})}),s.jsx(Dt,{show:ot,title:"Course Completed!",description:"You've mastered the Red-Black Tree.",onClose:()=>Se(!1),onBackToMenu:()=>{Se(!1),V.setView("menu")},backToMenuText:"Back to Menu"}),o==="manual"&&V.view==="menu"&&!localStorage.getItem("ds-playground-avl-prerequisite-seen")&&s.jsx(Ft,{structureId:"rb",onDismiss:()=>{}}),X&&s.jsx("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-slate-900/60 p-4 backdrop-blur-sm animate-in fade-in",onClick:n=>{n.target===n.currentTarget&&B(!1)},children:s.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-lg w-full overflow-hidden relative animate-in zoom-in-95 duration-200",children:[s.jsx(_e,{onClick:()=>B(!1),className:"absolute top-6 right-6 cursor-pointer text-slate-400 hover:text-slate-600 transition-colors z-10"}),s.jsxs("div",{className:"bg-blue-600 p-6 text-white",children:[s.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-2",children:[s.jsx(Tt,{})," ",e("rbtree:guide.helpTitle")]}),s.jsxs("div",{className:"flex gap-2 mt-4",children:[s.jsx("button",{onClick:()=>M("concept"),className:`px-4 py-1.5 rounded-full text-xs font-bold transition-all ${L==="concept"?"bg-white text-blue-600":"bg-blue-700 text-blue-200 hover:bg-blue-500"}`,children:"Operation"}),s.jsx("button",{onClick:()=>M("ui"),className:`px-4 py-1.5 rounded-full text-xs font-bold transition-all ${L==="ui"?"bg-white text-blue-600":"bg-blue-700 text-blue-200 hover:bg-blue-500"}`,children:"Interface"})]})]}),s.jsx("div",{className:"p-8 space-y-6",children:L==="concept"?s.jsxs(s.Fragment,{children:[s.jsx("p",{className:"text-slate-600 font-medium text-sm leading-relaxed",children:e("rbtree:guide.helpDesc")}),s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[s.jsxs("div",{className:"group flex gap-4 p-4 rounded-2xl bg-blue-50 border border-blue-100 transition-colors hover:bg-blue-100",children:[s.jsx("div",{className:"bg-white p-3 rounded-xl shadow-sm h-fit",children:s.jsx(_t,{className:"text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-blue-900 text-sm",children:e("rbtree:guide.helpRecolor")}),s.jsx(G,{text:e("rbtree:guide.helpRecolorDesc"),className:"text-blue-700"})]})]}),s.jsxs("div",{className:"group flex gap-4 p-4 rounded-2xl bg-indigo-50 border border-indigo-100 transition-colors hover:bg-indigo-100",children:[s.jsx("div",{className:"bg-white p-3 rounded-xl shadow-sm h-fit",children:s.jsx(zt,{className:"text-indigo-600"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-indigo-900 text-sm",children:e("rbtree:guide.helpRotate")}),s.jsx(G,{text:e("rbtree:guide.helpRotateDesc"),className:"text-sm text-indigo-700"})]})]})]}),s.jsx("button",{onClick:()=>M("ui"),className:"w-full bg-slate-100 text-slate-500 py-4 rounded-2xl font-bold hover:bg-slate-200 active:scale-95 transition-all mt-6 text-xs uppercase tracking-widest",children:"Next: Interface Guide"})]}):s.jsxs("div",{className:"flex flex-col items-center gap-6 py-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-0 bg-blue-500 rounded-full blur-xl opacity-20 animate-pulse"}),s.jsx(ze,{size:48,className:"text-blue-500 relative z-10"})]}),s.jsxs("div",{className:"text-center space-y-2",children:[s.jsx("h4",{className:"font-bold text-slate-900 text-lg",children:e("rbtree:guide.ui.start")}),s.jsx("p",{className:"text-sm text-slate-500 max-w-xs mx-auto",children:e("rbtree:guide.ui.startDesc")})]}),s.jsxs("button",{onClick:()=>{B(!1),ge(0)},className:"px-8 py-3 bg-blue-600 text-white rounded-xl font-bold shadow-xl shadow-blue-500/20 hover:scale-105 active:scale-95 transition-all text-xs uppercase tracking-widest flex items-center gap-2",children:[e("rbtree:guide.ui.startBtn")," ",s.jsx(He,{size:14})]})]})})]})}),Ae()]}),s.jsxs("div",{className:"bg-white border-t border-slate-200 p-3 sm:p-4 flex flex-col lg:flex-row gap-4 lg:gap-4 items-stretch overflow-visible shadow-[0_-10px_40px_rgba(0,0,0,0.03)] z-[100]",children:[s.jsxs(Ge,{label:"Operations",className:`w-full lg:w-[320px] ${fe(3)}`,children:[s.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-2 w-full",children:[s.jsxs("div",{className:"flex gap-2 items-center bg-white p-1 rounded-xl border border-slate-200 flex-grow overflow-hidden shadow-sm",children:[s.jsx("input",{value:Ce,onChange:n=>ue(n.target.value),onKeyDown:n=>n.key==="Enter"&&Le(),className:"flex-grow min-w-0 px-2 text-xs font-bold outline-none text-center",placeholder:"Val"}),s.jsx("button",{onClick:Le,disabled:x,className:"px-4 py-1.5 bg-blue-600 text-white rounded-lg text-[11px] font-black shadow-md shrink-0 active:scale-95 transition-all",children:"INSERT"})]}),s.jsxs("button",{onClick:pt,disabled:x,className:"px-4 py-2.5 bg-red-600 text-white rounded-xl text-[11px] font-black shadow-lg flex items-center gap-2 active:scale-95 transition-all shrink-0",children:[s.jsx(tt,{size:14})," DELETE"]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[s.jsx("span",{className:"text-slate-500 font-bold",children:"Delete Strategy:"}),s.jsx("button",{onClick:()=>lt(xe==="successor"?"predecessor":"successor"),className:"flex-1 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 rounded-lg font-bold transition-all text-[10px] uppercase tracking-wider",children:xe==="successor"?"ðŸ“ Inorder Successor":"ðŸ“ Inorder Predecessor"})]}),s.jsxs("button",{onClick:xt,disabled:x,className:`w-full flex items-center justify-center gap-2 py-1.5 border border-dashed text-[10px] font-black rounded-lg transition-all uppercase tracking-widest ${ne?"bg-red-600 border-red-600 text-white animate-bounce":"border-slate-200 text-slate-400 hover:bg-red-50 hover:text-red-500"}`,children:[s.jsx(Bt,{size:12,className:ne?"animate-spin":""})," ",ne?"Confirm Reset?":"Reset Playground"]})]}),s.jsx(Ge,{label:"Timeline",className:`flex-grow ${fe(4)}`,metadata:`Step ${Math.max(0,T+1)} / ${H.length}`,children:s.jsx(Et,{isPlaying:x,isPaused:!x,onTogglePause:()=>x?oe():Re(H.length,T),onGoToStep:ct,currentStep:T,totalSteps:H.length,onUndo:gt,onRedo:ft,canUndo:I>0,canRedo:I<j.length-1,playbackSpeed:_,setPlaybackSpeed:F})})]})]})]})};export{Qt as RedBlackTreePage};
