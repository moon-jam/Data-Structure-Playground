import{j as s,m as Xe,c as Ge,C as Ye,s as ft,t as xt,p as Fe,n as Je,o as Me,d as Ae,X as Re,P as Oe,S as bt,B as mt,e as vt,f as kt,I as Ie,T as wt,h as Nt,i as jt,k as yt,l as St,R as Ct,u as $t}from"./vendor-ui-CvNuzZug.js";import{r as p}from"./vendor-react-CTD4pAUy.js";import{v as Rt}from"./v4-EwEgHOG0.js";import{S as It}from"./SEO-B01spWqt.js";import{S as J,C as Ue,P as Tt}from"./PlaybackControls-DysuMvJB.js";import{C as _t,P as zt}from"./PrerequisiteBanner-BFEn72aO.js";import{u as Qe}from"./index-CjUOVJ4L.js";class xe{id;value;color;left;right;parent;x=0;y=0;constructor(l,t="red"){this.id=Rt(),this.value=l,this.color=t,this.left=null,this.right=null,this.parent=null}clone(){const l=new xe(this.value,this.color);return l.id=this.id,this.left&&(l.left=this.left.clone(),l.left.parent=l),this.right&&(l.right=this.right.clone(),l.right.parent=l),l}}class Bt{root;steps;deletionStrategy;constructor(l="successor"){this.root=null,this.steps=[],this.deletionStrategy=l}getSnapshot(){return this.root?this.root.clone():null}clear(){this.root=null,this.steps=[]}find(l){let t=this.root;for(;t;){if(l===t.value)return t;l<t.value?t=t.left:t=t.right}return null}getNode(l){return this.find(l)}addStep(l,t,i=[]){this.steps.push({type:l,message:t,targetIds:i,payload:{snapshot:this.getSnapshot()}})}leftRotate(l){const t=l.right;l.right=t.left,t.left&&(t.left.parent=l),t.parent=l.parent,l.parent?l===l.parent.left?l.parent.left=t:l.parent.right=t:this.root=t,t.left=l,l.parent=t,this.addStep("move",`Left rotation: node ${l.value} rotated with node ${t.value}`,[t.id,l.id])}rightRotate(l){const t=l.left;l.left=t.right,t.right&&(t.right.parent=l),t.parent=l.parent,l.parent?l===l.parent.left?l.parent.left=t:l.parent.right=t:this.root=t,t.right=l,l.parent=t,this.addStep("move",`Right rotation: node ${l.value} rotated with node ${t.value}`,[t.id,l.id])}insert(l){this.steps=[];const t=new xe(l,"red");if(!this.root)return t.color="black",this.root=t,this.addStep("insert",`Inserted root ${l} (Black)`,[t.id]),this.steps;let i=this.root,o=null;for(;i;)if(o=i,l<i.value)i=i.left;else if(l>i.value)i=i.right;else return this.addStep("error",`Value ${l} already exists`,[i.id]),this.steps;return t.parent=o,l<o.value?o.left=t:o.right=t,this.addStep("insert",`Inserted ${l} (Red)`,[t.id]),this.insertFixup(t),this.addStep("complete",`Insertion of ${l} complete`),this.steps}insertFixup(l){let t=l;for(;t.parent&&t.parent.color==="red";){const i=t.parent.parent;if(!i)break;if(t.parent===i.left){const o=i.right;o&&o.color==="red"?(this.addStep("highlight",`Case 3: Uncle ${o.value} is Red - Recoloring nodes ${t.parent.value}, ${o.value}, ${i.value}`,[t.parent.id,o.id,i.id]),t.parent.color="black",o.color="black",i.color="red",this.addStep("move",`Recolored: Parent ${t.parent.value}â†’Black, Uncle ${o.value}â†’Black, Grandparent ${i.value}â†’Red`,[t.parent.id,o.id,i.id]),t=i):(t===t.parent.right&&(t=t.parent,this.addStep("highlight",`Case 4: Triangle (LR) - Left rotate node ${t.value}`,[t.id]),this.leftRotate(t)),this.addStep("highlight",`Case 5: Line (LL) - Operating on nodes ${t.parent.value} and ${i.value}`,[t.parent.id,i.id]),t.parent.color="black",i.color="red",this.addStep("move",`Recolored: Node ${t.parent.value}â†’Black, Node ${i.value}â†’Red`,[t.parent.id,i.id]),this.rightRotate(i))}else{const o=i.left;o&&o.color==="red"?(this.addStep("highlight",`Case 3 (Mirror): Uncle ${o.value} is Red - Recoloring nodes ${t.parent.value}, ${o.value}, ${i.value}`,[t.parent.id,o.id,i.id]),t.parent.color="black",o.color="black",i.color="red",this.addStep("move",`Recolored: Parent ${t.parent.value}â†’Black, Uncle ${o.value}â†’Black, Grandparent ${i.value}â†’Red`,[t.parent.id,o.id,i.id]),t=i):(t===t.parent.left&&(t=t.parent,this.addStep("highlight",`Case 4 (Mirror): Triangle (RL) - Right rotate node ${t.value}`,[t.id]),this.rightRotate(t)),this.addStep("highlight",`Case 5 (Mirror): Line (RR) - Operating on nodes ${t.parent.value} and ${i.value}`,[t.parent.id,i.id]),t.parent.color="black",i.color="red",this.addStep("move",`Recolored: Node ${t.parent.value}â†’Black, Node ${i.value}â†’Red`,[t.parent.id,i.id]),this.leftRotate(i))}}this.root.color==="red"&&(this.root.color="black",this.addStep("move",`Root node ${this.root.value} recolored to black`,[this.root.id]))}validate(){const l=[];return this.root&&(this.root.color==="red"&&l.push({type:"root-red",nodeIds:[this.root.id],message:"Root must be black"}),this.checkRedRed(this.root,l),this.checkBlackHeight(this.root,l)),l}checkRedRed(l,t){l&&(l.color==="red"&&(l.left&&l.left.color==="red"&&t.push({type:"red-red",nodeIds:[l.id,l.left.id],message:"Red node cannot have Red child"}),l.right&&l.right.color==="red"&&t.push({type:"red-red",nodeIds:[l.id,l.right.id],message:"Red node cannot have Red child"})),this.checkRedRed(l.left,t),this.checkRedRed(l.right,t))}checkBlackHeight(l,t){if(!l)return 1;const i=this.checkBlackHeight(l.left,t),o=this.checkBlackHeight(l.right,t);return i!==o&&i!==-1&&o!==-1?(t.push({type:"black-height",nodeIds:[l.id],message:`Black height mismatch: L=${i}, R=${o}`}),-1):i===-1||o===-1?-1:i+(l.color==="black"?1:0)}insertManual(l){if(this.steps=[],this.findNode(this.root,l))return this.addStep("error",`Value ${l} already exists in the tree`),this.steps;const t=new xe(l,"red");if(!this.root)return this.root=t,this.addStep("insert",`Inserted root ${l} (Red) - Violation!`,[t.id]),this.steps;this._insertBST(this.root,t),this.addStep("insert",`Inserted ${l} (Red)`,[t.id]);const i=this.validate();return i.length>0&&this.addStep("error",`Violations found: ${i.map(o=>o.type).join(", ")}`,i.flatMap(o=>o.nodeIds)),this.steps}_insertBST(l,t){t.value<l.value?l.left?this._insertBST(l.left,t):(l.left=t,t.parent=l):l.right?this._insertBST(l.right,t):(l.right=t,t.parent=l)}toggleColor(l){this.steps=[];const t=this.getNodeById(l);return t&&(t.color=t.color==="red"?"black":"red",this.addStep("move",`Toggled node ${t.value} to ${t.color}`,[t.id])),this.steps}rotateNode(l,t){this.steps=[];const i=this.findNode(this.root,l);if(!i)return this.steps;if(t==="left"){if(!i.right)return this.addStep("error","Cannot rotate left: No right child",[i.id]),this.steps;this.leftRotate(i)}else{if(!i.left)return this.addStep("error","Cannot rotate right: No left child",[i.id]),this.steps;this.rightRotate(i)}return this.steps}findNode(l,t){return l?l.value===t?l:t<l.value?this.findNode(l.left,t):this.findNode(l.right,t):null}getNodeById(l){return this._getNodeById(this.root,l)}_getNodeById(l,t){return l?l.id===t?l:this._getNodeById(l.left,t)||this._getNodeById(l.right,t):null}delete(l){this.steps=[];let t=this.root;for(;t;)if(l<t.value)t=t.left;else if(l>t.value)t=t.right;else break;if(!t)return this.addStep("error",`Value ${l} not found`),this.steps;this.addStep("highlight",`Found node ${l} to delete`,[t.id]);let i=t,o=i.color,g,f;return t.left?t.right?(this.deletionStrategy==="predecessor"?(i=this.maximum(t.left),this.addStep("highlight",`Replace with predecessor (max of left subtree): ${i.value}`,[i.id,t.id])):(i=this.minimum(t.right),this.addStep("highlight",`Replace with successor (min of right subtree): ${i.value}`,[i.id,t.id])),o=i.color,this.deletionStrategy==="predecessor"?(g=i.left,i.parent===t?f=i:(f=i.parent,this.transplant(i,i.left),i.left=t.left,i.left&&(i.left.parent=i)),this.transplant(t,i),i.right=t.right,i.right&&(i.right.parent=i),i.color=t.color):(g=i.right,i.parent===t?f=i:(f=i.parent,this.transplant(i,i.right),i.right=t.right,i.right&&(i.right.parent=i)),this.transplant(t,i),i.left=t.left,i.left&&(i.left.parent=i),i.color=t.color)):(g=t.left,f=t.parent,this.transplant(t,t.left)):(g=t.right,f=t.parent,this.transplant(t,t.right)),o==="black"&&this.deleteFixup(g,g?g.parent:f),this.addStep("complete",`Deletion of ${l} complete`),this.steps}deleteManual(l){this.steps=[];let t=this.root;for(;t;)if(l<t.value)t=t.left;else if(l>t.value)t=t.right;else break;if(!t)return this.addStep("error",`Value ${l} not found`),{steps:this.steps,needsFixup:!1,fixupParentId:null,fixupIsLeft:null,deletedWasBlack:!1};this.addStep("highlight",`Found node ${l} to delete`,[t.id]);let i=t,o=i.color,g,f,v=null;t.left?t.right?(this.deletionStrategy==="predecessor"?(i=this.maximum(t.left),this.addStep("highlight",`Replace with predecessor (max of left subtree): ${i.value}`,[i.id,t.id])):(i=this.minimum(t.right),this.addStep("highlight",`Replace with successor (min of right subtree): ${i.value}`,[i.id,t.id])),o=i.color,this.deletionStrategy==="predecessor"?(g=i.left,i.parent===t?(f=i,v=!0):(f=i.parent,v=i.parent?i===i.parent.left:null,this.transplant(i,i.left),i.left=t.left,i.left&&(i.left.parent=i)),this.transplant(t,i),i.right=t.right,i.right&&(i.right.parent=i),i.color=t.color):(g=i.right,i.parent===t?(f=i,v=!1):(f=i.parent,v=i.parent?i===i.parent.left:null,this.transplant(i,i.right),i.right=t.right,i.right&&(i.right.parent=i)),this.transplant(t,i),i.left=t.left,i.left&&(i.left.parent=i),i.color=t.color),this.addStep("delete",`Replaced ${t.value} with ${i.value}`,[i.id])):(g=t.left,f=t.parent,v=t.parent?t===t.parent.left:null,this.transplant(t,t.left),this.addStep("delete",`Removed node ${l} (no right child)`,[])):(g=t.right,f=t.parent,v=t.parent?t===t.parent.left:null,this.transplant(t,t.right),this.addStep("delete",`Removed node ${l} (no left child)`,[]));const O=o==="black";return O?this.addStep("error",`Black node deleted - fixup required! Double-black at ${g?`node ${g.value}`:"NIL position"}`,f?[f.id]:[]):o==="red"?this.addStep("complete","Deletion complete - deleted node was Red, no fixup needed"):g&&g.color==="red"&&this.addStep("highlight",`Node ${g.value} should be recolored to Black to restore balance`,[g.id]),{steps:this.steps,needsFixup:O,fixupParentId:f?.id||null,fixupIsLeft:v,deletedWasBlack:o==="black"}}transplant(l,t){l.parent?l===l.parent.left?l.parent.left=t:l.parent.right=t:this.root=t,t&&(t.parent=l.parent)}minimum(l){for(;l.left;)l=l.left;return l}maximum(l){for(;l.right;)l=l.right;return l}deleteFixup(l,t){for(;(!l||l.color==="black")&&l!==this.root;)if(t?.left===l){let o=t.right;o&&o.color==="red"&&(this.addStep("highlight",`Fixup Case 1: Sibling ${o.value} is Red, operating on nodes ${o.value} and ${t.value}`,[o.id,t.id]),o.color="black",t.color="red",this.leftRotate(t),o=t.right),(!o?.left||o.left.color==="black")&&(!o?.right||o.right.color==="black")?(this.addStep("highlight",`Fixup Case 2: Sibling ${o?o.value:"null"} is Black with Black nephews`,[o?o.id:t.id]),o&&(o.color="red"),l=t,t=l?.parent||null):((!o?.right||o.right.color==="black")&&(this.addStep("highlight",`Fixup Case 3: Close nephew is Red - Rotate sibling ${o.value}`,[o.id]),o?.left&&(o.left.color="black"),o&&(o.color="red"),this.rightRotate(o),o=t.right),this.addStep("highlight",`Fixup Case 4: Far nephew is Red - Rotate parent ${t.value}`,[t.id]),o&&(o.color=t.color,o.right&&(o.right.color="black")),t.color="black",this.leftRotate(t),l=this.root,t=null)}else{let o=t.left;o&&o.color==="red"&&(this.addStep("highlight",`Fixup Case 1 (Mirror): Sibling ${o.value} is Red, operating on nodes ${o.value} and ${t.value}`,[o.id,t.id]),o.color="black",t.color="red",this.rightRotate(t),o=t.left),(!o?.right||o.right.color==="black")&&(!o?.left||o.left.color==="black")?(this.addStep("highlight",`Fixup Case 2 (Mirror): Sibling ${o?o.value:"null"} is Black with Black nephews`,[o?o.id:t.id]),o&&(o.color="red"),l=t,t=l?.parent||null):((!o?.left||o.left.color==="black")&&(this.addStep("highlight",`Fixup Case 3 (Mirror): Close nephew is Red - Rotate sibling ${o.value}`,[o.id]),o?.right&&(o.right.color="black"),o&&(o.color="red"),this.leftRotate(o),o=t.left),this.addStep("highlight",`Fixup Case 4 (Mirror): Far nephew is Red - Rotate parent ${t.value}`,[t.id]),o&&(o.color=t.color,o.left&&(o.left.color="black")),t.color="black",this.rightRotate(t),l=this.root,t=null)}l&&(l.color="black")}}const G=25,Te=({node:e,x:l,y:t,level:i,highlightedIds:o=[],selectedId:g,onNodeClick:f,onNodeDrag:v,pulsingId:O,violations:U=[],onMouseEnter:X,onMouseLeave:L})=>{const[F,W]=p.useState(!1),R=o.includes(e.id),Q=g===e.id,C=e.color==="red",w=O===e.id,j=!!v,M=U.filter(x=>x.nodeIds.includes(e.id)),I=M.length>0,z=M[0]?.type,B=p.useRef(!1),N=()=>{B.current=!0},T=(x,k)=>{const _=k.offset.x;Math.abs(_)>30&&v&&v(e,_>0?"right":"left"),setTimeout(()=>{B.current=!1},50)},H=x=>{x.stopPropagation(),B.current||f?.(e)};return s.jsxs(s.Fragment,{children:[s.jsxs(Xe.div,{initial:{left:l-G,top:t-G},animate:{left:l-G,top:t-G},transition:{duration:.3,ease:"easeOut"},onClick:H,onMouseEnter:()=>{W(!0),X?.()},onMouseLeave:()=>{W(!1),L?.()},drag:j?"x":!1,dragConstraints:{left:0,right:0,top:0,bottom:0},dragElastic:.2,dragSnapToOrigin:!0,onDragStart:N,onDragEnd:T,className:`absolute flex items-center justify-center border-2 rounded-full shadow-md z-20 font-bold select-none text-white no-pan transition-transform
          ${Q?"ring-4 ring-blue-400 border-blue-500":R?"ring-4 ring-amber-400 border-amber-500":C?"border-red-600":"border-slate-800"}
          ${C?"bg-red-500":"bg-slate-900"}
          ${I?"ring-4 ring-red-500/50 animate-pulse":""}
          ${w?"animate-bounce ring-4 ring-green-400":""}
          ${j?"cursor-grab active:cursor-grabbing":"cursor-pointer"}
        `,style:{width:G*2,height:G*2,touchAction:"none"},children:[j&&F&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"absolute -left-8 top-1/2 -translate-y-1/2 text-blue-500 opacity-70 animate-pulse",children:s.jsx(Ge,{size:18})}),s.jsx("div",{className:"absolute -right-8 top-1/2 -translate-y-1/2 text-blue-500 opacity-70 animate-pulse",children:s.jsx(Ye,{size:18})})]}),e.value,I&&s.jsxs("div",{className:"absolute -top-3 -right-3 z-30 group",children:[s.jsx("div",{className:"bg-red-600 text-white text-[8px] px-1.5 py-0.5 rounded-full border border-white shadow-sm whitespace-nowrap cursor-help",children:z==="red-red"?"é•è¦":z==="root-red"?"æ ¹":"é»‘é«˜"}),s.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-50",children:[s.jsxs("div",{className:"bg-slate-900 text-white text-[10px] px-3 py-2 rounded-lg shadow-xl whitespace-nowrap",children:[z==="red-red"&&s.jsxs("span",{children:["âš ï¸ ",s.jsx("b",{children:"ç´…ç´…é•è¦"}),"ï¼šç´…è‰²ç¯€é»žä¸èƒ½æœ‰ç´…è‰²å­ç¯€é»ž"]}),z==="root-red"&&s.jsxs("span",{children:["âš ï¸ ",s.jsx("b",{children:"æ ¹ç¯€é»žé•è¦"}),"ï¼šæ ¹ç¯€é»žå¿…é ˆæ˜¯é»‘è‰²"]}),z==="black-height"&&s.jsxs("span",{children:["âš ï¸ ",s.jsx("b",{children:"é»‘é«˜é•è¦"}),"ï¼šè·¯å¾‘ä¸Šçš„é»‘è‰²ç¯€é»žæ•¸é‡ä¸ä¸€è‡´"]})]}),s.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900"})]})]})]},e.id),e.left&&s.jsxs(s.Fragment,{children:[s.jsx(We,{parentX:l,parentY:t,childX:e.left.x,childY:e.left.y,childColor:e.left.color,hasError:U.some(x=>x.type==="red-red"&&x.nodeIds.includes(e.id)&&x.nodeIds.includes(e.left.id))}),s.jsx(Te,{node:e.left,x:e.left.x,y:e.left.y,level:i+1,highlightedIds:o,selectedId:g,onNodeClick:f,onNodeDrag:v,pulsingId:O,violations:U,onMouseEnter:X,onMouseLeave:L})]}),e.right&&s.jsxs(s.Fragment,{children:[s.jsx(We,{parentX:l,parentY:t,childX:e.right.x,childY:e.right.y,childColor:e.right.color,hasError:U.some(x=>x.type==="red-red"&&x.nodeIds.includes(e.id)&&x.nodeIds.includes(e.right.id))}),s.jsx(Te,{node:e.right,x:e.right.x,y:e.right.y,level:i+1,highlightedIds:o,selectedId:g,onNodeClick:f,onNodeDrag:v,pulsingId:O,violations:U,onMouseEnter:X,onMouseLeave:L})]})]})},We=({parentX:e,parentY:l,childX:t,childY:i,childColor:o,hasError:g})=>{const f=g||o==="red"?"#ef4444":"#cbd5e1";return s.jsx("svg",{className:"absolute top-0 left-0 w-px h-px overflow-visible pointer-events-none z-10",children:s.jsx(Xe.line,{initial:{x1:e,y1:l+G,x2:t,y2:i-G},animate:{x1:e,y1:l+G,x2:t,y2:i-G},transition:{duration:.3,ease:"easeOut"},stroke:f,strokeWidth:g?"4":"2",className:g?"animate-pulse opacity-50":""})})};function Ht({manifest:e,structureId:l,structure:t,onReset:i,onUpdateView:o}){const[g,f]=p.useState("menu"),[v,O]=p.useState(0),[U,X]=p.useState(0),[L,F]=p.useState([]),[W,R]=p.useState(""),[Q,C]=p.useState(null),w=`ds-playground-${l}-max-level`,j=`ds-playground-${l}-completed-lessons`;p.useEffect(()=>{const N=localStorage.getItem(w);N&&X(parseInt(N));const T=localStorage.getItem(j);if(T)try{F(JSON.parse(T))}catch{F([])}},[w,j]);const M=p.useCallback(N=>{N<0||N>=e.length||(O(N),f("lesson"),R(""),C(null),i(),e[N].setup(t),o&&o())},[e,t,i,o]),I=p.useCallback(N=>{const T=N||e[v].id;if(!L.includes(T)){const x=[...L,T];F(x),localStorage.setItem(j,JSON.stringify(x))}const H=v+1;H>U&&(X(H),localStorage.setItem(w,H.toString()))},[v,U,L,e,w,j]),z=p.useCallback(()=>{const N=e[v];if(N.type!=="quiz"||N.answer===void 0)return;const T=parseInt(W);!isNaN(T)&&T===N.answer?(C("correct"),I()):C("wrong")},[e,v,W,I]),B=p.useCallback(()=>{localStorage.removeItem(w),localStorage.removeItem(j),X(0),F([])},[w,j]);return{view:g,setView:f,lessonIndex:v,currentLesson:e[v],maxUnlocked:U,completedLessons:L,quizInput:W,setQuizInput:R,quizFeedback:Q,runLesson:M,completeLesson:I,checkQuiz:z,resetProgress:B}}const Vt=[{id:1,nameKey:"phase1",icon:"ðŸ“š"},{id:2,nameKey:"phase2",icon:"âž•"},{id:3,nameKey:"phase3",icon:"âž–"},{id:4,nameKey:"phase4",icon:"ðŸŽ“"}];function Pt({view:e,setView:l,lessonIndex:t,currentLesson:i,maxUnlocked:o,manifest:g,completedLessons:f,runLesson:v,resetProgress:O,completeLesson:U,quizInput:X,setQuizInput:L,checkQuiz:F,quizFeedback:W,i18nNamespace:R,onFinish:Q,renderExtraContent:C}){const{t:w}=Qe([R,"common"]),[j,M]=p.useState(!1),[I,z]=p.useState([1]),B=p.useMemo(()=>{const k={1:[],2:[],3:[],4:[]};return g.forEach((_,D)=>{const Z=_.phase||1;k[Z].push({lesson:_,idx:D})}),k},[g]),N=(k,_)=>k.unlockCondition?k.unlockCondition(f):_<=o,T=k=>(B[k]||[]).some(({lesson:D,idx:Z})=>N(D,Z)),H=k=>{z(_=>_.includes(k)?_.filter(D=>D!==k):[..._,k])};if(e==="menu")return s.jsxs("div",{className:"space-y-3 animate-in fade-in",children:[s.jsxs("div",{className:"p-3 bg-slate-800 rounded-xl border border-slate-700",children:[s.jsx("h3",{className:"text-white font-bold mb-1 text-sm",children:w(`${R}:tutorial.title`)}),s.jsx("p",{className:"text-[10px] text-slate-400",children:w(`${R}:tutorial.welcome`)})]}),Vt.map(k=>{const _=B[k.id]||[],D=T(k.id),Z=I.includes(k.id),he=_.filter(({lesson:q})=>f.includes(q.id)).length;return s.jsxs("div",{className:`border rounded-xl overflow-hidden ${D?"border-slate-700":"border-slate-800 opacity-60"}`,children:[s.jsxs("button",{onClick:()=>H(k.id),disabled:!D,className:`w-full flex items-center justify-between p-3 transition-colors ${D?"bg-slate-800 hover:bg-slate-700":"bg-slate-900 cursor-not-allowed"}`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{children:k.icon}),s.jsx("span",{className:`text-xs font-bold uppercase ${D?"text-white":"text-slate-600"}`,children:w(`${R}:tutorial.phases.${k.nameKey}`)}),s.jsxs("span",{className:"text-[10px] text-slate-500",children:["(",he,"/",_.length,")"]})]}),D?Z?s.jsx(ft,{size:14,className:"text-slate-400"}):s.jsx(Ye,{size:14,className:"text-slate-400"}):s.jsx(xt,{size:12,className:"text-slate-600"})]}),Z&&D&&s.jsx("div",{className:"p-2 bg-slate-900/50 grid grid-cols-2 gap-2",children:_.map(({lesson:q,idx:ne})=>{const ee=N(q,ne),ae=f.includes(q.id);return s.jsxs("button",{onClick:()=>ee&&v(ne),disabled:!ee,className:`p-2 rounded-lg border text-left transition-all ${ee?ae?"bg-green-900/20 border-green-700/50 hover:bg-green-900/30":"bg-slate-800 border-slate-700 hover:bg-slate-700 hover:border-blue-500/50":"bg-slate-900 border-slate-800 opacity-50 cursor-not-allowed"}`,children:[s.jsxs("div",{className:"flex justify-between items-start mb-1",children:[s.jsx("span",{className:`text-[9px] font-black uppercase px-1 py-0.5 rounded ${ee?ae?"bg-green-500/20 text-green-400":"bg-blue-600 text-white":"bg-slate-800 text-slate-600"}`,children:q.type==="concept"?"ðŸ“–":q.type==="quiz"?"â“":q.type==="challenge"?"âš¡":"ðŸŽ¯"}),ae&&s.jsx(Fe,{size:12,className:"text-green-500"}),!ee&&s.jsx("span",{className:"text-slate-600 text-[10px]",children:"ðŸ”’"})]}),s.jsx("div",{className:`text-[10px] font-bold leading-tight ${ee?"text-slate-300":"text-slate-600"}`,children:w(`${R}:tutorial.levels.${q.id}.title`)})]},q.id)})})]},k.id)}),f.length>0&&s.jsxs("button",{onClick:()=>{if(!j){M(!0),setTimeout(()=>M(!1),3e3);return}O(),M(!1)},className:`w-full py-2 mt-2 text-[10px] font-bold rounded-xl transition-colors uppercase tracking-widest flex items-center justify-center gap-2 border ${j?"bg-red-600 border-red-600 text-white animate-pulse":"border-transparent text-red-400 hover:text-red-300 hover:bg-red-900/20 hover:border-red-900/30"}`,children:[s.jsx(Je,{size:12})," ",j?"Confirm Reset?":"Reset Progress"]})]});const x=f.includes(i.id);return s.jsxs("div",{className:"space-y-6 animate-in slide-in-from-right-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx("button",{onClick:()=>l("menu"),className:"p-1 hover:bg-slate-800 rounded text-slate-400 hover:text-white transition-colors",children:s.jsx(Ge,{size:16})}),s.jsxs("span",{className:"text-xs font-black text-slate-500 uppercase tracking-widest",children:[i.type==="concept"?"ðŸ“–":i.type==="quiz"?"â“":i.type==="challenge"?"âš¡":"ðŸŽ¯"," ",w(`${R}:tutorial.levels.${i.id}.title`)]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(J,{text:w(`${R}:tutorial.levels.${i.id}.desc`),className:"text-slate-400 text-sm"}),C&&C(),i.type==="quiz"&&!x&&s.jsxs("div",{className:"bg-slate-800 p-4 rounded-xl border border-slate-700 space-y-3",children:[s.jsx("p",{className:"text-sm font-bold text-slate-300",children:w(`${R}:tutorial.levels.${i.id}.question`,{val:i.targetVal,defaultValue:"What is the value?"})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"number",value:X,onChange:k=>L(k.target.value),onKeyDown:k=>k.key==="Enter"&&F(),className:"flex-1 bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-white font-mono text-center outline-none focus:border-blue-500",placeholder:"?"}),s.jsx("button",{onClick:F,className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs uppercase hover:bg-blue-500",children:"SUBMIT"})]}),W==="correct"&&s.jsxs("div",{className:"text-green-400 text-xs font-bold flex items-center gap-1",children:[s.jsx(Me,{size:12})," Correct!"]}),W==="wrong"&&s.jsx("div",{className:"text-red-400 text-xs font-bold",children:"Incorrect, try again."})]})]}),s.jsxs("div",{className:"flex flex-col gap-2 pt-4 border-t border-slate-800",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>v(t),className:"flex-1 py-2.5 bg-slate-800 text-slate-400 rounded-xl text-[10px] font-bold uppercase hover:bg-slate-700 transition-colors",children:w("common:reset","Reset")}),i.type==="concept"&&!x&&s.jsx("button",{onClick:()=>U(),className:"flex-[2] py-2.5 bg-blue-600 text-white rounded-xl text-[10px] font-bold uppercase flex items-center justify-center gap-2 hover:bg-blue-500 shadow-lg shadow-blue-900/20",children:w("common:iUnderstand","I Understand âœ“")}),x&&t<g.length-1&&s.jsxs("button",{onClick:()=>v(t+1),className:"flex-[2] py-2.5 bg-green-600 text-white rounded-xl text-[10px] font-bold uppercase flex items-center justify-center gap-2 hover:bg-green-500 shadow-lg shadow-green-900/20",children:[w("common:next","Next Level")," ",s.jsx(Me,{size:14})]}),x&&t===g.length-1&&s.jsxs("button",{onClick:Q,className:"flex-[2] py-2.5 bg-blue-600 text-white rounded-xl text-[10px] font-bold uppercase flex items-center justify-center gap-2 hover:bg-blue-500 shadow-lg shadow-blue-900/20",children:[w("common:finish","Finish")," ",s.jsx(Fe,{size:14})]})]}),x&&t<g.length-1&&s.jsx("button",{onClick:()=>l("menu"),className:"w-full py-2 text-slate-500 text-[10px] font-bold uppercase hover:text-slate-300 transition-colors",children:w("common:backToMenu","â† Back to Menu")})]})]})}const K=(e,l)=>e.every(t=>l.includes(t)),Y=(e,l)=>e.filter(t=>l.includes(t)).length,oe=["insert_case0","insert_case1_1","insert_case1_2","insert_case2_1","insert_case2_2","insert_case3_1","insert_case3_2","insert_challenge"],qe=["delete_red_leaf","delete_red_replacement","delete_case1","delete_case2","delete_case3","delete_case4","delete_challenge"],Ke=[{id:"basics",type:"concept",phase:1,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15)},allowHintToggle:!1},{id:"colors",type:"concept",phase:1,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15),e.insert(3),e.insert(7)},unlockCondition:e=>K(["basics"],e),allowHintToggle:!1},{id:"black_height",type:"concept",phase:1,setup:e=>{e.clear(),e.insert(20),e.insert(10),e.insert(30),e.insert(5),e.insert(15),e.insert(25),e.insert(35)},unlockCondition:e=>K(["basics","colors"],e),allowHintToggle:!1},{id:"rotations",type:"guided",phase:1,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15),e.insert(3)},check:e=>e.validate().length===0,unlockCondition:e=>K(["basics","colors","black_height"],e),allowHintToggle:!0},{id:"foundation_quiz",type:"quiz",phase:1,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15)},answer:2,unlockCondition:e=>K(["basics","colors","black_height","rotations"],e),allowHintToggle:!1},{id:"insert_case0",type:"concept",phase:2,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15)},check:e=>e.find(3)!==null&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!1},{id:"insert_case1_1",type:"guided",phase:2,setup:e=>{e.clear(),e.insert(30),e.insert(20),e.insert(40),e.root&&(e.root.color="black"),e.getNode(20)&&(e.getNode(20).color="black"),e.getNode(40)&&(e.getNode(40).color="black"),e.insert(10),e.insert(25),e.getNode(10)&&(e.getNode(10).color="red"),e.getNode(25)&&(e.getNode(25).color="red")},check:e=>e.find(5)!==null&&e.getNode(20)?.color==="red"&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!0},{id:"insert_case1_2",type:"guided",phase:2,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15),e.root&&(e.root.color="black"),e.root?.left&&(e.root.left.color="red"),e.root?.right&&(e.root.right.color="red")},check:e=>e.find(1)!==null&&e.root?.color==="black"&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!0},{id:"insert_case2_1",type:"guided",phase:2,setup:e=>{e.clear(),e.insert(20),e.insert(15),e.insert(25),e.root&&(e.root.color="black"),e.getNode(15)&&(e.getNode(15).color="black"),e.getNode(25)&&(e.getNode(25).color="black"),e.insert(10),e.getNode(10)&&(e.getNode(10).color="red")},check:e=>e.find(5)!==null&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!0},{id:"insert_case2_2",type:"guided",phase:2,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15),e.root&&(e.root.color="black"),e.getNode(5)&&(e.getNode(5).color="black"),e.getNode(15)&&(e.getNode(15).color="black"),e.insert(20),e.getNode(20)&&(e.getNode(20).color="red")},check:e=>e.find(25)!==null&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!0},{id:"insert_case3_1",type:"guided",phase:2,setup:e=>{e.clear(),e.insert(20),e.insert(10),e.insert(25),e.root&&(e.root.color="black"),e.getNode(10)&&(e.getNode(10).color="black"),e.getNode(25)&&(e.getNode(25).color="black"),e.insert(5),e.getNode(5)&&(e.getNode(5).color="red")},check:e=>e.find(7)!==null&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!0},{id:"insert_case3_2",type:"guided",phase:2,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(20),e.root&&(e.root.color="black"),e.getNode(5)&&(e.getNode(5).color="black"),e.getNode(20)&&(e.getNode(20).color="black"),e.insert(25),e.getNode(25)&&(e.getNode(25).color="red")},check:e=>e.find(22)!==null&&e.validate().length===0,unlockCondition:e=>K(["foundation_quiz"],e),allowHintToggle:!0},{id:"insert_challenge",type:"challenge",phase:2,setup:e=>{e.clear()},check:e=>[20,10,30,5,4,40,35].every(i=>e.find(i)!==null)&&e.validate().length===0,unlockCondition:e=>Y(oe.slice(0,7),e)>=6,allowHintToggle:!1},{id:"delete_red_leaf",type:"guided",phase:3,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15),e.root&&(e.root.color="black"),e.getNode(5)&&(e.getNode(5).color="red"),e.getNode(15)&&(e.getNode(15).color="red")},check:e=>e.find(5)===null&&e.validate().length===0,unlockCondition:e=>Y(oe.slice(0,7),e)>=5,allowHintToggle:!0},{id:"delete_red_replacement",type:"guided",phase:3,setup:e=>{e.clear(),e.insert(10),e.insert(5),e.insert(15),e.insert(2),e.root&&(e.root.color="black"),e.getNode(5)&&(e.getNode(5).color="black"),e.getNode(15)&&(e.getNode(15).color="black"),e.getNode(2)&&(e.getNode(2).color="red")},check:e=>e.find(5)===null&&e.validate().length===0,unlockCondition:e=>Y(oe.slice(0,6),e)>=3,allowHintToggle:!0},{id:"delete_case1",type:"guided",phase:3,setup:e=>{e.clear(),e.insert(20),e.insert(10),e.insert(30),e.insert(25),e.insert(35),e.root&&(e.root.color="black"),e.getNode(10)&&(e.getNode(10).color="black"),e.getNode(30)&&(e.getNode(30).color="red"),e.getNode(25)&&(e.getNode(25).color="black"),e.getNode(35)&&(e.getNode(35).color="black")},check:e=>e.find(10)===null&&e.validate().length===0,unlockCondition:e=>Y(oe.slice(0,6),e)>=3,allowHintToggle:!0},{id:"delete_case2",type:"guided",phase:3,setup:e=>{e.clear(),e.insert(20),e.insert(10),e.insert(30),e.root&&(e.root.color="black"),e.getNode(10)&&(e.getNode(10).color="black"),e.getNode(30)&&(e.getNode(30).color="black")},check:e=>e.find(10)===null&&e.validate().length===0,unlockCondition:e=>Y(oe.slice(0,6),e)>=3,allowHintToggle:!0},{id:"delete_case3",type:"guided",phase:3,setup:e=>{e.clear(),e.insert(20),e.insert(10),e.insert(30),e.insert(25),e.root&&(e.root.color="black"),e.getNode(10)&&(e.getNode(10).color="black"),e.getNode(30)&&(e.getNode(30).color="black"),e.getNode(25)&&(e.getNode(25).color="red")},check:e=>e.find(10)===null&&e.validate().length===0,unlockCondition:e=>Y(oe.slice(0,6),e)>=3,allowHintToggle:!0},{id:"delete_case4",type:"guided",phase:3,setup:e=>{e.clear(),e.insert(20),e.insert(10),e.insert(30),e.insert(35),e.root&&(e.root.color="black"),e.getNode(10)&&(e.getNode(10).color="black"),e.getNode(30)&&(e.getNode(30).color="black"),e.getNode(35)&&(e.getNode(35).color="red")},check:e=>e.find(10)===null&&e.validate().length===0,unlockCondition:e=>Y(oe.slice(0,6),e)>=3,allowHintToggle:!0},{id:"delete_challenge",type:"challenge",phase:3,setup:e=>{e.clear(),e.insert(50),e.insert(25),e.insert(75),e.insert(10),e.insert(30),e.insert(60),e.insert(85),e.insert(5),e.insert(15)},check:e=>e.find(25)===null&&e.find(75)===null&&e.validate().length===0,unlockCondition:e=>Y(qe.slice(0,6),e)>=3,allowHintToggle:!1},{id:"final_challenge",type:"challenge",phase:4,setup:e=>{e.clear(),e.insert(40),e.insert(20),e.insert(60),e.insert(10),e.insert(30),e.insert(50),e.insert(70)},check:e=>e.find(5)!==null&&e.find(25)!==null&&e.find(10)===null&&e.validate().length===0,unlockCondition:e=>Y(qe.slice(0,6),e)>=3,allowHintToggle:!1},{id:"graduation",type:"concept",phase:4,setup:e=>{e.clear(),e.insert(42)},unlockCondition:e=>K(["final_challenge"],e),allowHintToggle:!1}],Ut=()=>{const{t:e}=Qe(["common","rbtree"],{useSuspense:!1}),[l]=p.useState(()=>new Bt),[t,i]=p.useState(null),[o,g]=p.useState("auto"),[f,v]=p.useState([]),[O,U]=p.useState(null),[X,L]=p.useState(!1),[F,W]=p.useState("concept"),[R,Q]=p.useState(window.innerWidth>768),[C,w]=p.useState("logs"),[j,M]=p.useState([]),[I,z]=p.useState(-1),[B,N]=p.useState([]),[T,H]=p.useState(-1),[x,k]=p.useState(!1),[_,D]=p.useState(1),[Z,he]=p.useState([]),[q,ne]=p.useState(null),[ee,ae]=p.useState("info"),[re,be]=p.useState(!1),[me,ve]=p.useState(null),[pe,Ze]=p.useState("successor"),[et,de]=p.useState(!1),[_e,A]=p.useState(null),[ke,we]=p.useState(null),[tt,Ne]=p.useState(!1),V=Ht({manifest:Ke,structureId:"rb",structure:l,onReset:()=>{l.root=null,i(null),v([]),P(null),se(null),M([{id:"init",action:"Lesson Start",steps:[],finalSnapshot:null}]),z(0),N([]),H(-1),g("manual")},onUpdateView:()=>{i(fe(l.root)),v(l.validate())}});p.useEffect(()=>{if(C==="tutorial"&&V.view==="lesson"&&!x){const n=V.currentLesson;n.type==="concept"&&o!=="auto"?g("auto"):(n.type==="guided"||n.type==="challenge")&&o!=="manual"&&g("manual"),(n.type==="guided"||n.type==="challenge")&&n.check&&n.check(l)&&l.validate().length===0&&V.completeLesson()}},[I,l,V,C,x,o]),p.useEffect(()=>{C==="tutorial"&&V.view==="lesson"&&de(!1)},[V.lessonIndex,C,V.view]);const[m,P]=p.useState(null),[te,se]=p.useState(null),[je,ce]=p.useState(""),ye=p.useRef(null);p.useEffect(()=>{l.deletionStrategy=pe},[pe,l]);const[st,lt]=p.useState(320),[ge,ze]=p.useState(!1),[it,Be]=p.useState(!1),ot=()=>ze(!0),He=()=>ze(!1),Ve=n=>{if(ge){const r=n.clientX;r>=280&&r<600&&lt(r)}};p.useEffect(()=>(window.addEventListener("mousemove",Ve),window.addEventListener("mouseup",He),()=>{window.removeEventListener("mousemove",Ve),window.removeEventListener("mouseup",He)}),[ge]),p.useEffect(()=>{I===-1&&(M([{id:"init",action:"Initial",steps:[],finalSnapshot:null}]),z(0))},[]),p.useEffect(()=>{if(re){const n=setTimeout(()=>be(!1),3e3);return()=>clearTimeout(n)}},[re]);const fe=n=>{if(!n)return null;const r=new Map,a=c=>{if(!c)return 0;const S=a(c.left),$=a(c.right),y=Math.max(60,S+$+40);return r.set(c.id,y),y};a(n);let d=0;const u=(c,S)=>{c&&(u(c.left,S+1),c.x=d*60,c.y=S*80,d++,u(c.right,S+1))};u(n,0);const h=n.x,b=c=>{c&&(c.x-=h,b(c.left),b(c.right))};return b(n),n},le=(n,r)=>{ie(),N(r),H(0);const a=r.length>0&&r[r.length-1].payload?.snapshot?r[r.length-1].payload.snapshot:l.getSnapshot(),d=j.slice(0,I+1);d.push({id:Math.random().toString(36),action:n,steps:r,finalSnapshot:a}),M(d),z(d.length-1),Se(r.length)},Se=(n,r=0)=>{k(!0);let a=r;const d=()=>{a<n-1?(a++,H(a),ye.current=setTimeout(d,800/_)):k(!1)};d()},ie=()=>{ye.current&&clearTimeout(ye.current),k(!1)},rt=n=>{ie(),n>=0&&n<B.length&&H(n)};p.useEffect(()=>{if(B.length>0&&T>=0){const n=B[T];if(n.payload?.snapshot!==void 0){const r=n.payload.snapshot;i(fe(r))}he(n.targetIds||[]),ne(n.message||null),ae(n.type||"info")}},[T,B,o]),p.useEffect(()=>{o==="manual"&&!x?v(l.validate()):o==="auto"&&v([])},[I,o,l,t,x]);const Pe=()=>{const n=je.split(",").map(r=>parseInt(r.trim())).filter(r=>!isNaN(r));if(n.length>0)if(o==="auto"){const r=[];n.forEach(a=>{const d=l.insert(a);r.push(...d)}),le(`Batch Insert ${n.join(", ")}`,r),ce("")}else{const r=n[0],a=l.insertManual(r);le(`Insert ${r}`,a),n.length>1?ce(n.slice(1).join(",")):ce("")}},nt=n=>{if(!x)if(o==="manual"){if(m&&m.steps.length>0){const r=m.steps.findIndex(a=>!a.isCompleted&&!a.isSkipped&&a.action==="recolor"&&a.nodeValue===n.value);if(r!==-1){le(`Toggle Color ${n.value}`,l.toggleColor(n.id));const a=[...m.steps];a[r]={...a[r],isCompleted:!0};const d=a.findIndex(u=>!u.isCompleted&&!u.isSkipped);P({...m,steps:a,currentStepIndex:d===-1?a.length:d});return}else{if(m.steps.some(h=>(h.isCompleted||h.isSkipped)&&h.action==="recolor"&&h.nodeValue===n.value)){A(`${e("rbtree:guide.alreadyDone")}`),setTimeout(()=>A(null),3e3);return}const d=m.steps.filter(h=>!h.isCompleted&&!h.isSkipped),u=d.length>0?d.map(h=>h.action==="recolor"?`${e("rbtree:guide.clickNode")} ${h.nodeValue}`:`${e("rbtree:guide.dragNode")} ${h.nodeValue}`).join(" "+e("common:or")+" "):e("rbtree:guide.allStepsComplete");A(`${e("rbtree:guide.wrongAction")} ${e("rbtree:guide.expected")}: ${u}`),setTimeout(()=>A(null),3e3);return}}le(`Toggle Color ${n.value}`,l.toggleColor(n.id))}else ve(n)},at=(n,r)=>{if(!x&&o==="manual"){if(m&&m.steps.length>0){const a=m.steps.findIndex(d=>!d.isCompleted&&!d.isSkipped&&d.action==="rotate"&&d.nodeValue===n.value&&d.direction===r);if(a!==-1){if(m.steps.some(b=>!b.isCompleted&&!b.isSkipped&&b.action==="recolor")){A(e("rbtree:guide.performRecolorFirst")),setTimeout(()=>A(null),3e3);return}le(`Rotate ${r} ${n.value}`,l.rotateNode(n.value,r));const u=[...m.steps];u[a]={...u[a],isCompleted:!0};const h=u.findIndex(b=>!b.isCompleted&&!b.isSkipped);P({...m,steps:u,currentStepIndex:h===-1?u.length:h});return}else{const d=m.steps.findIndex(c=>!c.isCompleted&&!c.isSkipped&&c.action==="rotate"&&c.nodeValue===n.value&&c.direction!==r);if(d!==-1){const c=m.steps[d];A(`${e("rbtree:guide.wrongDirection")} ${e("rbtree:guide.expected")}: ${c.direction==="left"?e("common:left"):e("common:right")}`),setTimeout(()=>A(null),3e3);return}if(m.steps.some(c=>(c.isCompleted||c.isSkipped)&&c.action==="rotate"&&c.nodeValue===n.value)){A(`${e("rbtree:guide.alreadyDone")}`),setTimeout(()=>A(null),3e3);return}const h=m.steps.filter(c=>!c.isCompleted&&!c.isSkipped),b=h.length>0?h.map(c=>c.action==="recolor"?`${e("rbtree:guide.clickNode")} ${c.nodeValue}`:`${e("rbtree:guide.dragNode")} ${c.nodeValue}`).join(" "+e("common:or")+" "):e("rbtree:guide.allStepsComplete");A(`${e("rbtree:guide.wrongAction")} ${e("rbtree:guide.expected")}: ${b}`),setTimeout(()=>A(null),3e3);return}}le(`Rotate ${r} ${n.value}`,l.rotateNode(n.value,r))}},dt=()=>{const n=me?me.value:parseInt(je);if(!isNaN(n)){if(o==="manual"){const r=l.deleteManual(n);if(le(`Delete ${n}`,r.steps),r.needsFixup&&r.fixupParentId){const a={parentId:r.fixupParentId,isLeftChild:r.fixupIsLeft,needsFixup:!0};se(a),setTimeout(()=>{if(l.validate().length===0){se(null);return}const u=ue(a);u?(P(u),de(!1)):se(null)},100)}else r.deletedWasBlack&&r.needsFixup,se(null),P(null)}else le(`Delete ${n}`,l.delete(n));ce(""),ve(null)}},ue=n=>{if(!n||!n.needsFixup||!n.parentId)return null;const r=l.getNodeById(n.parentId);if(!r)return null;const a=n.isLeftChild,d=a?r.right:r.left,u=a?r.left:r.right,h=[];let b="";const c=y=>!y||y.color==="black",S=y=>y?.color==="red",$=(y,E,$e)=>{const Le=$e?.color===E;h.push({action:"recolor",nodeValue:y,targetColor:E,description:`${y} â†’ ${e(E==="black"?"common:black":"common:red")}`,isSkipped:Le,skipReason:Le?e("rbtree:guide.alreadyCorrectColor",{val:y,color:e(E==="black"?"common:black":"common:red")}):void 0})};if(!r)return null;if(u&&S(u))return b=e("rbtree:guide.deleteSimpleCase"),$(u.value,"black",u),{caseType:b,steps:h,currentStepIndex:0,originalViolationNodeIds:u?[u.id]:[]};if(!d)return null;if(S(d))b=e("rbtree:guide.deleteCase1"),$(d.value,"black",d),$(r.value,"red",r),h.push({action:"rotate",nodeValue:r.value,direction:a?"left":"right",description:e("rbtree:guide.dragToRotate",{val:r.value,dir:e(a?"common:left":"common:right")})});else{const y=a?d.left:d.right,E=a?d.right:d.left;c(y)&&c(E)?(b=e("rbtree:guide.deleteCase2"),$(d.value,"red",d),S(r)&&$(r.value,"black",r)):S(y)&&c(E)?(b=e("rbtree:guide.deleteCase3"),$(y.value,"black",y),$(d.value,"red",d),h.push({action:"rotate",nodeValue:d.value,direction:a?"right":"left",description:e("rbtree:guide.dragToRotate",{val:d.value,dir:e(a?"common:right":"common:left")})})):S(E)&&(b=e("rbtree:guide.deleteCase4"),$(d.value,r.color,d),$(r.value,"black",r),$(E.value,"black",E),h.push({action:"rotate",nodeValue:r.value,direction:a?"left":"right",description:e("rbtree:guide.dragToRotate",{val:r.value,dir:e(a?"common:left":"common:right")})}))}return h.length===0?null:{caseType:b,steps:h,currentStepIndex:0,originalViolationNodeIds:[r.id]}},ct=()=>{if(I<=0||x)return;ie();const n=I-1,r=j[n];l.root=r.finalSnapshot?r.finalSnapshot.clone():null,i(fe(l.root)),N(r.steps),H(r.steps.length>0?r.steps.length-1:-1),z(n)},ut=()=>{if(I>=j.length-1||x)return;ie();const n=I+1,r=j[n];z(n),N(r.steps),H(0),Se(r.steps.length)},ht=()=>{if(!re){be(!0);return}be(!1),x&&ie(),l.root=null,i(null),M([{id:"init",action:"Cleared",steps:[],finalSnapshot:null}]),z(0),N([]),H(-1),he([]),ne(null),ve(null),de(!1),we(null),P(null)},pt=()=>{if(f.length===0)return null;const n=f.filter(a=>{if(a.type==="root-red")return l.root&&l.root.color==="red";if(a.type==="red-red"){const d=l.getNodeById(a.nodeIds[0]),u=a.nodeIds[1]?l.getNodeById(a.nodeIds[1]):null;return!(!d||d.color!=="red"||u&&u.color!=="red"||u&&d.left!==u&&d.right!==u)}if(a.type==="black-height"){const d=l.getNodeById(a.nodeIds[0]);if(!d)return!1;const u=c=>{if(!c)return 1;const S=u(c.left),$=u(c.right);return S===-1||$===-1||S!==$?-1:S+(c.color==="black"?1:0)},h=u(d.left),b=u(d.right);return h===-1||b===-1||h!==b}return!0});if(n.length===0)return null;const r=n.find(a=>a.type==="root-red");if(r)return r;if(ke){const a=n.find(d=>d.nodeIds.includes(ke));if(a)return a}return n[0]},Ce=()=>{const n=pt();if(!n)return null;const r=[];let a="";if(n.type==="root-red"){const d=l.root;if(!d)return null;a=e("rbtree:guide.caseRootRed"),r.push({action:"recolor",nodeValue:d.value,targetColor:"black",description:e("rbtree:guide.actionRootRed",{val:d.value})})}else if(n.type==="red-red"){const d=n.nodeIds[0],u=n.nodeIds[1],h=l.getNodeById(d),b=u?l.getNodeById(u):null,c=h?.parent;if(!h||!b||!c)return null;const S=h===c.left?c.right:c.left;if(S?.color==="red")a=e("rbtree:guide.caseUncleRed"),r.push({action:"recolor",nodeValue:h.value,targetColor:"black",description:`${h.value} â†’ ${e("common:black")}`}),S&&r.push({action:"recolor",nodeValue:S.value,targetColor:"black",description:`${S.value} â†’ ${e("common:black")}`}),c===l.root?r.push({action:"recolor",nodeValue:c.value,targetColor:"red",description:`${c.value} â†’ ${e("common:red")}`,isSkipped:!0,skipReason:e("rbtree:guide.skippedRootStaysBlack")}):r.push({action:"recolor",nodeValue:c.value,targetColor:"red",description:`${c.value} â†’ ${e("common:red")}`});else{const y=h===c.left&&b===h.left,E=h===c.right&&b===h.right,$e=h===c.left&&b===h.right,De=h===c.right&&b===h.left;E?(a=e("rbtree:guide.caseRRBlack"),r.push({action:"recolor",nodeValue:h.value,targetColor:"black",description:`${h.value} â†’ ${e("common:black")}`}),r.push({action:"recolor",nodeValue:c.value,targetColor:"red",description:`${c.value} â†’ ${e("common:red")}`}),r.push({action:"rotate",nodeValue:c.value,direction:"left",description:e("rbtree:guide.dragToRotate",{val:c.value,dir:e("common:left")})})):y?(a=e("rbtree:guide.caseLLBlack"),r.push({action:"recolor",nodeValue:h.value,targetColor:"black",description:`${h.value} â†’ ${e("common:black")}`}),r.push({action:"recolor",nodeValue:c.value,targetColor:"red",description:`${c.value} â†’ ${e("common:red")}`}),r.push({action:"rotate",nodeValue:c.value,direction:"right",description:e("rbtree:guide.dragToRotate",{val:c.value,dir:e("common:right")})})):$e?(a=e("rbtree:guide.caseLRBlack"),r.push({action:"rotate",nodeValue:h.value,direction:"left",description:e("rbtree:guide.dragToRotate",{val:h.value,dir:e("common:left")})})):De&&(a=e("rbtree:guide.caseRLBlack"),r.push({action:"rotate",nodeValue:h.value,direction:"right",description:e("rbtree:guide.dragToRotate",{val:h.value,dir:e("common:right")})}))}}else if(n.type==="black-height"){const d=l.getNodeById(n.nodeIds[0]);if(!d)return null;const u=$=>{if(!$)return 1;const y=u($.left),E=u($.right);return y===-1||E===-1||y!==E?-1:y+($.color==="black"?1:0)},h=u(d.left),b=u(d.right);let c=!1;if(h!==-1&&b!==-1)if(h<b)c=!0;else if(b<h)c=!1;else return null;else return null;const S={needsFixup:!0,parentId:d.id,isLeftChild:c};return ue(S)}return r.length===0?null:{caseType:a,steps:r,currentStepIndex:0,originalViolationNodeIds:n.nodeIds}},Ee=()=>{if(o!=="manual")return null;if(f.length===0)return m&&P(null),ke&&we(null),te&&se(null),null;if(x)return null;if(!et){const r=m&&m.steps.length>0,a=m?m.steps.filter(u=>u.isCompleted||u.isSkipped).length:0,d=te?.needsFixup;return s.jsx("button",{onClick:()=>{if(!m||m.steps.every(u=>u.isCompleted||u.isSkipped))if(d&&te){const u=ue(te);u&&P(u)}else{const u=Ce();u&&P(u)}de(!0)},className:"w-full py-3 mb-6 bg-amber-500/10 border-2 border-dashed border-amber-500/30 rounded-2xl text-amber-500 font-black text-[10px] uppercase tracking-widest animate-pulse hover:bg-amber-500/20 transition-colors",children:r?`${e("rbtree:guide.showHint")} (${a}/${m.steps.length})`:e(d?"rbtree:guide.showHintDelete":"rbtree:guide.showHint")})}if(!m){if(te?.needsFixup){const a=ue(te);if(a)return P(a),null}const r=Ce();return r&&P(r),null}if(m.steps.every(r=>r.isCompleted||r.isSkipped)){if(l.validate().length===0)return P(null),se(null),we(null),null;if(te?.needsFixup){const d=ue(te);if(d)return P(d),null}const a=Ce();return a&&P(a),null}return s.jsxs("div",{className:"bg-amber-950/50 border border-amber-500/30 p-4 rounded-xl text-amber-50 mb-6 relative group shadow-2xl animate-in slide-in-from-top-2",children:[s.jsx("button",{onClick:()=>{de(!1)},className:"absolute top-2 right-2 p-1 text-amber-500/50 hover:text-amber-500 transition-colors",children:s.jsx(Re,{size:14})}),s.jsxs("div",{className:"flex flex-col gap-1 mb-4 border-b border-amber-700/50 pb-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-amber-500/80 text-[9px] uppercase tracking-widest font-bold",children:[s.jsx(Ie,{size:14}),s.jsx("span",{children:e("rbtree:guide.currentSituation")})]}),s.jsx("div",{className:"text-base font-black text-amber-400 leading-tight",children:m.caseType}),s.jsxs("div",{className:"text-[10px] text-amber-500/60 font-mono",children:[e("rbtree:guide.wikiReference"),": ",m.caseType]})]}),s.jsx("div",{className:"space-y-2",children:m.steps.map((r,a)=>{const d=r.isCompleted,u=r.isSkipped,h=!d&&!u;return s.jsx("div",{className:`p-3 rounded-lg border transition-all ${u?"bg-slate-800/20 border-slate-700/20 opacity-60":d?"bg-green-900/20 border-green-700/30":"bg-amber-500/10 border-amber-500/30 ring-1 ring-amber-500/20"}`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${u?"bg-slate-700 text-slate-400":d?"bg-green-600 text-white":"bg-slate-800 border-2 border-amber-500/50 text-amber-500"}`,children:u?"â€”":d?s.jsx($t,{size:14,strokeWidth:4}):a+1}),s.jsxs("div",{className:`flex-1 ${d||u?"opacity-80":""}`,children:[r.action==="recolor"?s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:h?"text-amber-200 font-bold":"text-slate-400 line-through decoration-slate-600",children:e("rbtree:guide.clickToRecolor")}),s.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[s.jsx("span",{className:"font-mono font-bold",children:r.nodeValue}),s.jsx("span",{className:"text-slate-500",children:"â†’"}),s.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold ${r.targetColor==="black"?"bg-slate-900 text-white border border-slate-600":"bg-red-600 text-white"}`,children:r.targetColor==="black"?e("common:black"):e("common:red")})]})]}):s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:h?"text-amber-200 font-bold":"text-slate-400 line-through decoration-slate-600",children:e("rbtree:guide.dragToRotateLabel")}),s.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[s.jsx("span",{className:"text-white",children:e("rbtree:guide.dragNode")}),s.jsx("span",{className:"font-mono font-bold text-amber-200",children:r.nodeValue}),s.jsx("span",{className:"text-white",children:e("rbtree:guide.toThe")}),s.jsx("span",{className:`font-bold ${r.direction==="left"?"text-blue-400":"text-green-400"}`,children:r.direction==="left"?e("common:left"):e("common:right")})]})]}),s.jsxs("div",{className:"mt-2 flex gap-2",children:[u&&r.skipReason&&s.jsx("span",{className:"text-[10px] bg-slate-800 text-slate-400 px-1.5 py-0.5 rounded border border-slate-700",children:r.skipReason}),d&&!u&&s.jsx("span",{className:"text-[10px] bg-green-900/40 text-green-400 px-1.5 py-0.5 rounded border border-green-800/50",children:e("rbtree:guide.completedStep")})]})]})]})},a)})}),m.steps.filter(a=>!a.isCompleted&&!a.isSkipped).length===0?s.jsx("div",{className:"mt-4 pt-3 border-t border-green-700/30",children:s.jsxs("div",{className:"text-[10px] uppercase tracking-widest text-green-400 mb-2 font-bold",children:["âœ“ ",e("rbtree:guide.allStepsComplete")]})}):s.jsxs("div",{className:"mt-4 pt-3 border-t border-amber-700/30",children:[s.jsxs("div",{className:"text-[10px] uppercase tracking-widest text-amber-400 mb-2 font-bold animate-pulse",children:["ðŸ‘† ",e("rbtree:guide.currentAction")]}),s.jsx("div",{className:"text-xs text-amber-200/60",children:e("rbtree:guide.performAnyPending")})]})]})},gt=()=>{const n=V.currentLesson,r=f.length>0?s.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 p-3 rounded-xl animate-pulse mb-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-red-400 font-bold text-xs uppercase mb-1",children:[s.jsx(Ae,{size:14})," Attention"]}),s.jsx("div",{className:"text-red-300 text-xs",children:f.map((d,u)=>s.jsx("div",{children:d.message},u))})]}):null,a=n?.allowHintToggle?s.jsx("div",{className:"mt-2 text-slate-300 text-xs leading-relaxed font-mono",children:Ee()}):null;return s.jsxs("div",{children:[r,a]})};return s.jsxs("div",{className:`h-full w-full flex bg-slate-100 overflow-hidden relative font-sans text-slate-900 ${ge?"cursor-col-resize select-none":""}`,children:[s.jsx(It,{title:"Red-Black Tree Visualization",description:"Interactive Red-Black Tree visualization. Understand how color properties and rotations maintain balance.",keywords:["Red-Black Tree","RB Tree","Balanced Binary Search Tree","Visualization","Algorithm"]}),s.jsx("style",{children:ge?"* { transition: none !important; cursor: col-resize !important; user-select: none !important; }":""}),_e&&s.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 z-[10000] bg-amber-500 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 border border-amber-400 animate-in fade-in slide-in-from-top-4",children:[s.jsx(Ae,{size:20,className:"shrink-0"}),s.jsx("span",{className:"font-bold",children:_e}),s.jsx(Re,{size:18,onClick:()=>A(null),className:"cursor-pointer hover:bg-white/20 rounded-full"})]}),s.jsxs("div",{style:{width:R?window.innerWidth>768?`${st}px`:"100%":"0px"},className:`h-full flex flex-col bg-slate-900 border-r border-slate-800 shrink-0 z-[100] shadow-2xl relative ${R?"":"overflow-hidden"} ${window.innerWidth<=768?"fixed left-0 top-0":"relative"}`,children:[window.innerWidth<=768&&R&&s.jsx("button",{onClick:()=>Q(!1),className:"absolute top-4 right-4 text-white z-[110]",children:s.jsx(Oe,{size:24})}),s.jsxs("div",{className:"flex flex-col h-full w-full",children:[s.jsxs("div",{className:"flex p-2 gap-1 bg-slate-950/50",children:[s.jsxs("button",{onClick:()=>w("logs"),className:`flex-1 py-2 rounded-lg flex items-center justify-center gap-2 text-[9px] sm:text-[10px] font-black uppercase transition-all ${C==="logs"?"bg-blue-600 text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:[s.jsx(bt,{size:14}),s.jsx("span",{className:"hidden sm:inline",children:"Logs"})]}),s.jsxs("button",{onClick:()=>w("wiki"),className:`flex-1 py-2 rounded-lg flex items-center justify-center gap-2 text-[9px] sm:text-[10px] font-black uppercase transition-all ${C==="wiki"?"bg-amber-500 text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:[s.jsx(mt,{size:14}),s.jsx("span",{className:"hidden sm:inline",children:"Wiki"})]}),s.jsxs("button",{onClick:()=>{w("tutorial"),V.setView("menu")},className:`flex-1 py-2 rounded-lg flex items-center justify-center gap-2 text-[9px] sm:text-[10px] font-black uppercase transition-all ${C==="tutorial"?"bg-green-600 text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:[s.jsx(vt,{size:14}),s.jsx("span",{className:"hidden sm:inline",children:"Course"})]})]}),s.jsxs("div",{className:"flex-grow overflow-y-auto p-4 font-mono text-[10px] text-slate-300 custom-scrollbar",children:[C==="logs"&&s.jsxs("div",{className:"space-y-2",children:[Ee(),s.jsx("h3",{className:"text-slate-500 font-black uppercase tracking-[0.2em] mb-4",children:"History"}),j.slice(1).reverse().map((n,r)=>s.jsxs("button",{onClick:()=>{ie();const a=j.length-1-r;l.root=n.finalSnapshot?n.finalSnapshot.clone():null,i(fe(n.finalSnapshot)),N(n.steps),H(n.steps.length-1),z(a)},className:`w-full text-left p-3 rounded-xl border transition-all ${I===j.length-1-r?"bg-blue-600/20 border-blue-500/50 text-blue-100 shadow-inner":"bg-slate-800/30 border-slate-700/50 hover:bg-slate-800 text-slate-400"}`,children:[s.jsxs("div",{className:"flex justify-between items-center mb-1",children:[s.jsx("span",{className:"font-black uppercase tracking-wider",children:n.action}),s.jsxs("span",{className:"opacity-40 text-[8px]",children:[n.steps.length," steps"]})]}),s.jsx("div",{className:"text-[9px] opacity-60 truncate",children:n.steps[n.steps.length-1]?.message})]},n.id))]}),C==="wiki"&&s.jsxs("div",{className:"space-y-8 font-sans pb-12 text-slate-400",children:[s.jsx("h3",{className:"text-white font-black text-xs uppercase tracking-[0.3em]",children:"Knowledge Base"}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-cyan-400 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.concept")}),s.jsx(J,{text:e("rbtree:wiki.conceptDesc")})]}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-slate-300 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.nilNodes")}),s.jsx(J,{text:e("rbtree:wiki.nilNodesDesc")})]}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-indigo-400 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.properties")}),s.jsx(J,{text:e("rbtree:wiki.propertiesDesc")})]}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-blue-400 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.blackHeight")}),s.jsx(J,{text:e("rbtree:wiki.blackHeightDesc")})]}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-emerald-400 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.insertion")}),s.jsx(J,{text:e("rbtree:wiki.insertionDesc")})]}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-rose-400 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.deletion")}),s.jsx(J,{text:e("rbtree:wiki.deletionDesc")})]}),s.jsxs("section",{children:[s.jsx("h4",{className:"text-purple-400 font-bold text-sm mb-2 uppercase",children:e("rbtree:wiki.complexity")}),s.jsx(J,{text:e("rbtree:wiki.complexityDesc")})]})]}),C==="tutorial"&&s.jsx(Pt,{...V,manifest:Ke,i18nNamespace:"rbtree",onFinish:()=>Ne(!0),renderExtraContent:gt})]})]}),R&&window.innerWidth>768&&s.jsx("div",{onMouseDown:ot,className:"absolute right-0 top-0 w-1.5 h-full cursor-col-resize z-[120] hover:bg-blue-500/50"})]}),s.jsxs("div",{className:"flex-grow flex flex-col min-w-0 h-full relative bg-white",children:[s.jsxs("div",{className:"flex-grow relative overflow-hidden bg-grid-slate-100",children:[s.jsx("button",{onClick:()=>Q(!R),className:"absolute bottom-6 left-6 z-30 w-10 h-10 bg-slate-900 text-white rounded-2xl shadow-xl flex items-center justify-center hover:scale-110 active:scale-90 transition-all",children:R?s.jsx(Oe,{size:20}):s.jsx(kt,{size:20})}),s.jsxs("div",{className:"absolute top-6 left-6 z-20 pointer-events-none flex flex-col gap-2",children:[s.jsxs("div",{className:"flex gap-2 pointer-events-auto",children:[s.jsx("button",{onClick:()=>g("auto"),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase transition-all ${o==="auto"?"bg-blue-600 text-white shadow-lg":"bg-white/50 text-slate-500 hover:bg-white"}`,children:"Auto"}),s.jsx("button",{onClick:()=>g("manual"),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase transition-all ${o==="manual"?"bg-amber-500 text-white shadow-lg":"bg-white/50 text-slate-500 hover:bg-white"}`,children:"Manual"})]}),V.view==="lesson"&&C==="tutorial"&&s.jsxs("div",{className:"bg-white/80 backdrop-blur-md px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase text-slate-500 shadow-sm border border-slate-200 pointer-events-auto",children:["Level ",V.lessonIndex,": ",e(`rbtree:tutorial.levels.${V.currentLesson.id}.title`)]}),q&&s.jsxs("div",{className:`${ee==="error"?"bg-red-600/90 border-red-400":"bg-blue-600/90 border-blue-400"} backdrop-blur-md px-4 py-2 rounded-2xl text-white shadow-lg border flex items-center gap-2 animate-in slide-in-from-left-4`,children:[s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-white animate-pulse shrink-0"}),s.jsx("span",{className:"text-xs font-black uppercase tracking-wider",children:q})]})]}),s.jsx("button",{onClick:()=>L(!0),className:"absolute top-6 right-6 w-10 h-10 bg-white/80 backdrop-blur-md border border-slate-200 rounded-2xl flex items-center justify-center text-slate-400 hover:text-blue-600 shadow-sm z-20",children:s.jsx(Ie,{size:20})}),s.jsx(wt,{initialScale:1,minScale:.1,maxScale:2,centerOnInit:!0,panning:{disabled:it,excluded:["no-pan"]},children:({zoomIn:n,zoomOut:r,resetTransform:a})=>s.jsxs(s.Fragment,{children:[s.jsx(Nt,{wrapperStyle:{width:"100%",height:"100%"},children:s.jsx("div",{className:"w-[4000px] h-[4000px] relative cursor-grab active:cursor-grabbing",children:s.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",style:{overflow:"visible"},children:t&&s.jsx(Te,{node:t,x:t.x,y:t.y,level:0,highlightedIds:Z,selectedId:me?.id,onNodeClick:nt,onNodeDrag:o==="manual"?at:void 0,pulsingId:O,violations:f,onMouseEnter:()=>Be(!0),onMouseLeave:()=>Be(!1)})})})}),s.jsxs("div",{className:"absolute bottom-6 right-6 z-20 flex flex-col gap-2",children:[s.jsx("button",{onClick:()=>n(),className:"w-10 h-10 bg-white shadow-sm border border-slate-200 rounded-xl flex items-center justify-center text-slate-600 hover:bg-white active:scale-90",children:s.jsx(jt,{size:20})}),s.jsx("button",{onClick:()=>r(),className:"w-10 h-10 bg-white shadow-sm border border-slate-200 rounded-xl flex items-center justify-center text-slate-600 hover:bg-white active:scale-90",children:s.jsx(yt,{size:20})}),s.jsx("button",{onClick:()=>a(),className:"w-10 h-10 bg-blue-600 text-white rounded-xl flex items-center justify-center shadow-lg active:scale-90 mt-2",children:s.jsx(St,{size:20})})]})]})}),s.jsx(_t,{show:tt,title:"Course Completed!",description:"You've mastered the Red-Black Tree.",onClose:()=>Ne(!1),onBackToMenu:()=>{Ne(!1),V.setView("menu")},backToMenuText:"Back to Menu"}),o==="manual"&&V.view==="menu"&&!localStorage.getItem("ds-playground-avl-prerequisite-seen")&&s.jsx(zt,{structureId:"rb",onDismiss:()=>{}}),X&&s.jsx("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-slate-900/60 p-4 backdrop-blur-sm animate-in fade-in",children:s.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-lg w-full overflow-hidden relative animate-in zoom-in-95 duration-200",children:[s.jsx(Re,{onClick:()=>L(!1),className:"absolute top-6 right-6 cursor-pointer text-slate-400 hover:text-slate-600 transition-colors z-10"}),s.jsxs("div",{className:"bg-blue-600 p-6 text-white",children:[s.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[s.jsx(Ie,{})," ",e("rbtree:guide.helpTitle")]}),s.jsxs("div",{className:"flex gap-2 mt-4",children:[s.jsx("button",{onClick:()=>W("concept"),className:`px-4 py-1.5 rounded-full text-xs font-bold transition-all ${F==="concept"?"bg-white text-blue-600":"bg-blue-700 text-blue-200 hover:bg-blue-500"}`,children:"Concept"}),s.jsx("button",{onClick:()=>W("ui"),className:`px-4 py-1.5 rounded-full text-xs font-bold transition-all ${F==="ui"?"bg-white text-blue-600":"bg-blue-700 text-blue-200 hover:bg-blue-500"}`,children:"Controls"})]})]}),s.jsx("div",{className:"p-6 space-y-4 max-h-[60vh] overflow-y-auto",children:F==="concept"?s.jsx("div",{className:"text-slate-600 text-sm leading-relaxed space-y-4",children:s.jsx(J,{text:e("rbtree:guide.helpDesc")})}):s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex gap-3 items-start",children:[s.jsx("div",{className:"bg-slate-100 p-2 rounded-lg text-slate-500 font-black text-xs uppercase w-20 shrink-0 text-center",children:"Auto"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Standard operations with auto-balancing."})]}),s.jsxs("div",{className:"flex gap-3 items-start",children:[s.jsx("div",{className:"bg-amber-100 p-2 rounded-lg text-amber-600 font-black text-xs uppercase w-20 shrink-0 text-center",children:"Manual"}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Insert nodes without balancing. Click nodes to ",s.jsx("b",{children:"Recolor"}),". Drag nodes (left/right) to ",s.jsx("b",{children:"Rotate"}),"."]})]})]})})]})})]}),s.jsxs("div",{className:"bg-white border-t border-slate-200 p-3 sm:p-4 flex flex-col lg:flex-row gap-4 lg:gap-4 items-stretch overflow-visible shadow-[0_-10px_40px_rgba(0,0,0,0.03)] z-[100]",children:[s.jsxs(Ue,{label:"Operations",className:"w-full lg:w-[320px]",children:[s.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-2 w-full",children:[s.jsxs("div",{className:"flex gap-2 items-center bg-white p-1 rounded-xl border border-slate-200 flex-grow overflow-hidden shadow-sm",children:[s.jsx("input",{value:je,onChange:n=>ce(n.target.value),onKeyDown:n=>n.key==="Enter"&&Pe(),className:"flex-grow min-w-0 px-2 text-xs font-bold outline-none text-center",placeholder:"Val"}),s.jsx("button",{onClick:Pe,disabled:x,className:"px-4 py-1.5 bg-blue-600 text-white rounded-lg text-[11px] font-black shadow-md shrink-0 active:scale-95 transition-all",children:"INSERT"})]}),s.jsxs("button",{onClick:dt,disabled:x,className:"px-4 py-2.5 bg-red-600 text-white rounded-xl text-[11px] font-black shadow-lg flex items-center gap-2 active:scale-95 transition-all shrink-0",children:[s.jsx(Je,{size:14})," DELETE"]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[s.jsx("span",{className:"text-slate-500 font-bold",children:"Delete Strategy:"}),s.jsx("button",{onClick:()=>Ze(pe==="successor"?"predecessor":"successor"),className:"flex-1 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 rounded-lg font-bold transition-all text-[10px] uppercase tracking-wider",children:pe==="successor"?"ðŸ“ Inorder Successor":"ðŸ“ Inorder Predecessor"})]}),s.jsxs("button",{onClick:ht,disabled:x,className:`w-full flex items-center justify-center gap-2 py-1.5 border border-dashed text-[10px] font-black rounded-lg transition-all uppercase tracking-widest ${re?"bg-red-600 border-red-600 text-white animate-bounce":"border-slate-200 text-slate-400 hover:bg-red-50 hover:text-red-500"}`,children:[s.jsx(Ct,{size:12,className:re?"animate-spin":""})," ",re?"Confirm Reset?":"Reset Playground"]})]}),s.jsx(Ue,{label:"Timeline",className:"flex-grow",metadata:`Step ${Math.max(0,T+1)} / ${B.length}`,children:s.jsx(Tt,{isPlaying:x,isPaused:!x,onTogglePause:()=>x?ie():Se(B.length,T),onGoToStep:rt,currentStep:T,totalSteps:B.length,onUndo:ct,onRedo:ut,canUndo:I>0,canRedo:I<j.length-1,playbackSpeed:_,setPlaybackSpeed:D})})]})]})]})};export{Ut as RedBlackTreePage};
