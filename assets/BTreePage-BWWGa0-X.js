import{j as t,m as D,P as J,S as ge,B as be,d as Q,e as we,g as ye,h as ke,i as je,k as ve,l as Se,n as Ne,R as $e}from"./vendor-ui-C1ZhIyyN.js";import{R as Ce,r as o}from"./vendor-react-B3rwDall.js";import{v as Te}from"./v4-EwEgHOG0.js";import{S,C as F,P as Le}from"./PlaybackControls-BPNwum8p.js";import{u as Re}from"./index-CnTEPlpt.js";let U=class te{id;keys;children;isLeaf;constructor(e=!1){this.id=Te(),this.keys=[],this.children=[],this.isLeaf=e}clone(){const e=new te(this.isLeaf);return e.id=this.id,e.keys=[...this.keys],e.children=this.children.map(s=>s.clone()),e}};class Z{root;order;minKeys;maxKeys;steps;constructor(e=3){this.root=null,this.steps=[],this.order=e,this.maxKeys=e-1,this.minKeys=Math.ceil(e/2)-1}setOrder(e){this.order=e,this.maxKeys=e-1,this.minKeys=Math.ceil(e/2)-1}getSnapshot(){return this.root?this.root.clone():null}addStep(e,s,i=[],r=!1){this.steps.push({type:e,message:s,targetIds:i,payload:{snapshot:r?void 0:this.getSnapshot()}})}search(e){return this.steps=[],this.root?this.searchRecursive(this.root,e):!1}searchRecursive(e,s){let i=0;for(;i<e.keys.length&&s>e.keys[i];)i++;return this.addStep("highlight",`Searching at node. Checking key at index ${i}`,[e.id],!0),i<e.keys.length&&s===e.keys[i]?(this.addStep("complete",`Found key ${s}`,[e.id],!0),!0):e.isLeaf?(this.addStep("error",`Key ${s} not found in leaf`,[e.id],!0),!1):this.searchRecursive(e.children[i],s)}searchKeyExists(e,s){let i=0;for(;i<e.keys.length&&s>e.keys[i];)i++;return i<e.keys.length&&s===e.keys[i]?!0:e.isLeaf?!1:this.searchKeyExists(e.children[i],s)}insert(e){if(this.steps=[],!this.root)return this.root=new U(!0),this.root.keys=[e],this.addStep("insert",`Tree empty. Created root with key ${e}`,[this.root.id]),this.steps;this.addStep("highlight",`Starting insertion of ${e}`,[this.root.id]);const s=this.insertRecursive(this.root,e);if(s){const i=this.root,r=new U(!1);r.keys=[s.key],r.children=[i,s.rightNode],this.root=r,this.addStep("move",`Created new root with key ${s.key}`,[r.id])}return this.addStep("complete",`Insertion of ${e} complete`),this.steps}insertRecursive(e,s){let i=0;for(;i<e.keys.length&&s>e.keys[i];)i++;if(e.isLeaf)return this.addStep("highlight","Found insertion position in leaf",[e.id]),e.keys.splice(i,0,s),this.addStep("insert",`Inserted ${s} into leaf`,[e.id]),e.keys.length>this.maxKeys?this.splitNode(e):null;this.addStep("highlight",`Descending to child ${i}`,[e.children[i].id]);const r=this.insertRecursive(e.children[i],s);return r&&(e.keys.splice(i,0,r.key),e.children.splice(i+1,0,r.rightNode),this.addStep("move",`Promoted ${r.key} from split child`,[e.id,r.rightNode.id]),e.keys.length>this.maxKeys)?this.splitNode(e):null}splitNode(e){const s=Math.floor(e.keys.length/2),i=e.keys[s],r=new U(e.isLeaf);return r.keys=e.keys.slice(s+1),e.isLeaf||(r.children=e.children.slice(s+1),e.children=e.children.slice(0,s+1)),e.keys=e.keys.slice(0,s),{key:i,rightNode:r}}delete(e){return this.steps=[],this.root?this.searchKeyExists(this.root,e)?(this.addStep("highlight",`Starting deletion of ${e}`,[this.root.id]),this.deleteFromTree(this.root,e),this.root.keys.length===0&&!this.root.isLeaf?(this.root=this.root.children[0],this.addStep("move",`Tree height reduced. New root: [${this.root.keys.join(",")}]`,[this.root.id])):this.root.keys.length===0&&this.root.isLeaf&&(this.addStep("highlight","Tree is now empty",[]),this.root=null),this.addStep("complete",`Deletion of ${e} complete`),this.steps):(this.addStep("error",`Key ${e} not found in tree`),this.steps):(this.addStep("error",`Tree is empty. Cannot delete ${e}`),this.steps)}deleteFromTree(e,s){const i=e.keys.findIndex(a=>a===s);if(i!==-1)if(e.isLeaf){const a=Math.ceil(this.order/2)-1;return e.keys.length>a?(e.keys.splice(i,1),this.addStep("delete",`Removed ${s} from leaf`,[e.id]),!1):(e.keys.splice(i,1),this.addStep("delete",`Removed ${s} from leaf (underflow)`,[e.id]),!0)}else{const a=e.children[i],c=this.findPredecessor(a),p=e.keys[i];return e.keys[i]=c.value,c.leafNode.keys[c.keyIndex]=p,this.addStep("move",`Swapped ${s} with predecessor ${c.value}`,[e.id,c.leafNode.id]),this.deleteFromTree(a,s)?this.handleUnderflow(e,i):!1}if(e.isLeaf)return!1;let r=0;for(;r<e.keys.length&&s>e.keys[r];)r++;const h=e.children[r];return h&&this.deleteFromTree(h,s)?this.handleUnderflow(e,r):!1}findPredecessor(e){let s=e;for(;!s.isLeaf;)s=s.children[s.children.length-1];const i=s.keys.length-1;return{leafNode:s,keyIndex:i,value:s.keys[i]}}handleUnderflow(e,s){const i=Math.ceil(this.order/2)-1;return s>0&&e.children[s-1].keys.length>i?(this.rotateFromLeft(e,s),!1):s<e.children.length-1&&e.children[s+1].keys.length>i?(this.rotateFromRight(e,s),!1):s>0?this.combineWithLeft(e,s):this.combineWithRight(e,s)}rotateFromLeft(e,s){const i=e.children[s],r=e.children[s-1];i.keys.unshift(e.keys[s-1]),e.keys[s-1]=r.keys.pop(),i.isLeaf||i.children.unshift(r.children.pop()),this.addStep("move",`Rotation: borrowed from left sibling [${r.keys.join(",")}] to [${i.keys.join(",")}]`,[e.id,r.id,i.id])}rotateFromRight(e,s){const i=e.children[s],r=e.children[s+1];i.keys.push(e.keys[s]),e.keys[s]=r.keys.shift(),i.isLeaf||i.children.push(r.children.shift()),this.addStep("move",`Rotation: borrowed from right sibling [${r.keys.join(",")}] to [${i.keys.join(",")}]`,[e.id,i.id,r.id])}combineWithLeft(e,s){const i=e.children[s],r=e.children[s-1],h=i.keys.join(","),u=r.keys.join(",");r.keys.push(e.keys[s-1]),r.keys.push(...i.keys),i.isLeaf||r.children.push(...i.children);const a=r.keys.join(",");e.keys.splice(s-1,1),e.children.splice(s,1),this.addStep("move",`Combine: merged [${h}] with left sibling [${u}] into [${a}]`,[e.id,r.id]);const c=Math.ceil(this.order/2)-1;return e.keys.length<c}combineWithRight(e,s){const i=e.children[s],r=e.children[s+1],h=i.keys.join(","),u=r.keys.join(",");i.keys.push(e.keys[s]),i.keys.push(...r.keys),i.isLeaf||i.children.push(...r.children);const a=i.keys.join(",");e.keys.splice(s,1),e.children.splice(s+1,1),this.addStep("move",`Combine: merged [${h}] with right sibling [${u}] into [${a}]`,[e.id,i.id]);const c=Math.ceil(this.order/2)-1;return e.keys.length<c}}const T=40,L=40,O=({node:n,highlightedIds:e=[],onKeyClick:s,depth:i=0})=>{const r=e.includes(n.id),h=n.keys.length*T,u=100-i;return n.keys.length===0?t.jsx(t.Fragment,{children:n.children.map(a=>t.jsx(O,{node:a,highlightedIds:e,onKeyClick:s,depth:i+1},a.id))}):t.jsxs(t.Fragment,{children:[n.children.map((a,c)=>{const p=n.keys.length*T,m=n.x-p/2+c*T;return t.jsxs(Ce.Fragment,{children:[t.jsx("svg",{className:"absolute pointer-events-none",style:{overflow:"visible",left:0,top:0,width:1,height:1,zIndex:5},children:t.jsx(D.line,{initial:{pathLength:0},animate:{x1:m,y1:n.y+L/2,x2:a.x,y2:a.y-L/2,pathLength:1},stroke:"#cbd5e1",strokeWidth:"2"})}),t.jsx(O,{node:a,highlightedIds:e,onKeyClick:s,depth:i+1})]},a.id)}),t.jsx(D.div,{animate:{left:n.x-h/2,top:n.y-L/2},transition:{type:"spring",stiffness:300,damping:30},className:`absolute flex items-center bg-white border-2 rounded-lg shadow-md overflow-hidden
          ${r?"border-amber-500 ring-4 ring-amber-200":"border-slate-800"}
        `,style:{width:h,height:L,zIndex:u},children:n.keys.map(a=>t.jsx(D.div,{onClick:c=>{c.stopPropagation(),s?.(a)},className:"flex items-center justify-center border-r border-slate-200 last:border-r-0 font-bold text-sm bg-slate-50 cursor-pointer hover:bg-blue-100 hover:text-blue-600 transition-colors",style:{width:T,height:"100%"},children:a},a))},n.id)]})},ze=40,ee=20,Ke=100,Ee=n=>n?se(n):null,se=n=>{const e=n.children.map(se),s=n.keys.length*ze;let i=0;e.length>0&&(e.forEach(h=>{i+=h.width}),i+=(e.length-1)*ee);const r=Math.max(s,i);if(e.length>0){let h=-i/2;e.forEach(u=>{ie(u,h+u.width/2,Ke),h+=u.width+ee})}return{...n,children:e,x:0,y:0,width:r}},ie=(n,e,s)=>{n.x+=e,n.y+=s,n.children.forEach(i=>ie(i,e,s))},Ue=()=>{const{t:n}=Re(["common","btree"],{useSuspense:!1}),[e,s]=o.useState(3),[i,r]=o.useState(()=>new Z(3)),[h,u]=o.useState(null),[a,c]=o.useState([]),[p,m]=o.useState(-1),[f,R]=o.useState([]),[x,j]=o.useState(-1),[w,z]=o.useState(!1),[B,re]=o.useState(1),[le,ne]=o.useState([]),[H,ae]=o.useState(null),[y,K]=o.useState(!1),[E,N]=o.useState(""),P=o.useRef(null),[k,I]=o.useState(window.innerWidth>768),[g,W]=o.useState("logs"),[oe,ce]=o.useState("menu"),[he,de]=o.useState(320),[$,_]=o.useState(!1),ue=()=>_(!0),G=()=>_(!1),V=l=>{if($){const d=l.clientX;d>=280&&d<600&&de(d)}};o.useEffect(()=>(window.addEventListener("mousemove",V),window.addEventListener("mouseup",G),()=>{window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",G)}),[$]),o.useEffect(()=>{p===-1&&(c([{id:"init",action:"Initial",steps:[]}]),m(0))},[]),o.useEffect(()=>{if(y){const l=setTimeout(()=>K(!1),3e3);return()=>clearTimeout(l)}},[y]);const A=l=>{s(l);const d=new Z(l);r(d),u(null),c([{id:"init",action:`Init Order ${l}`,steps:[]}]),m(0),R([]),j(-1)},X=(l,d)=>{C(),R(d),j(0),c([...a.slice(0,p+1),{id:Math.random().toString(36),action:l,steps:d}]),m(b=>b+1),Y(d.length)},Y=(l,d=0)=>{z(!0);let b=d;const v=()=>{b<l-1?(b++,j(b),P.current=setTimeout(v,800/B)):z(!1)};v()},C=()=>{P.current&&clearTimeout(P.current),z(!1)},M=l=>{C(),l>=0&&l<f.length&&j(l)};o.useEffect(()=>{if(f.length>0&&x>=0){const l=f[x];l.payload?.snapshot!==void 0&&u(l.payload.snapshot),ne(l.targetIds||[]),ae(l.message||null)}},[x,f]);const q=()=>{const l=parseInt(E);isNaN(l)||(X(`Insert ${l}`,i.insert(l)),N(""))},fe=()=>{const l=parseInt(E);isNaN(l)||(X(`Delete ${l}`,i.delete(l)),N(""))},xe=()=>{if(!y){K(!0);return}K(!1),A(e)},pe=l=>{N(l.toString())},me=()=>g!=="tutorial"?null:oe==="menu"?t.jsxs("div",{className:"space-y-4 animate-in fade-in",children:[t.jsxs("div",{className:"p-4 bg-slate-800 rounded-xl border border-slate-700",children:[t.jsx("h3",{className:"text-white font-bold mb-1",children:"B-Tree Course"}),t.jsx("p",{className:"text-xs text-slate-400",children:"Learn about multi-way balanced trees."})]}),t.jsxs("div",{className:"text-center py-10 opacity-30",children:[t.jsx(Q,{size:48,className:"mx-auto mb-4 text-slate-500"}),t.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-slate-500",children:"Levels Coming Soon"})]})]}):null;return t.jsxs("div",{className:`h-full w-full flex bg-slate-100 overflow-hidden relative font-sans text-slate-900 ${$?"cursor-col-resize select-none":""}`,children:[t.jsx("style",{children:$?"* { transition: none !important; cursor: col-resize !important; user-select: none !important; }":""}),t.jsxs("div",{style:{width:k?window.innerWidth>768?`${he}px`:"100%":"0px"},className:`h-full flex flex-col bg-slate-900 border-r border-slate-800 shrink-0 z-[100] shadow-2xl relative ${k?"":"overflow-hidden"} ${window.innerWidth<=768?"fixed left-0 top-0":"relative"}`,children:[window.innerWidth<=768&&k&&t.jsx("button",{onClick:()=>I(!1),className:"absolute top-4 right-4 text-white z-[110]",children:t.jsx(J,{size:24})}),t.jsxs("div",{className:"flex flex-col h-full w-full",children:[t.jsxs("div",{className:"flex p-2 gap-1 bg-slate-950/50",children:[t.jsxs("button",{onClick:()=>W("logs"),className:`flex-1 py-2 rounded-lg flex items-center justify-center gap-2 text-[9px] sm:text-[10px] font-black uppercase transition-all ${g==="logs"?"bg-blue-600 text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:[t.jsx(ge,{size:14}),t.jsx("span",{className:"hidden sm:inline",children:"Logs"})]}),t.jsxs("button",{onClick:()=>W("wiki"),className:`flex-1 py-2 rounded-lg flex items-center justify-center gap-2 text-[9px] sm:text-[10px] font-black uppercase transition-all ${g==="wiki"?"bg-amber-500 text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:[t.jsx(be,{size:14}),t.jsx("span",{className:"hidden sm:inline",children:"Wiki"})]}),t.jsxs("button",{onClick:()=>{W("tutorial"),ce("menu")},className:`flex-1 py-2 rounded-lg flex items-center justify-center gap-2 text-[9px] sm:text-[10px] font-black uppercase transition-all ${g==="tutorial"?"bg-green-600 text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:[t.jsx(Q,{size:14}),t.jsx("span",{className:"hidden sm:inline",children:"Course"})]})]}),t.jsxs("div",{className:"flex-grow overflow-y-auto p-4 font-mono text-[10px] text-slate-300 custom-scrollbar",children:[g==="logs"&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("h3",{className:"text-slate-500 font-black uppercase tracking-[0.2em] mb-4",children:"History"}),a.slice(1).reverse().map((l,d)=>t.jsxs("button",{onClick:()=>{C(),R(l.steps),j(l.steps.length-1),m(a.length-1-d)},className:`w-full text-left p-3 rounded-xl border transition-all ${p===a.length-1-d?"bg-blue-600/20 border-blue-500/50 text-blue-100 shadow-inner":"bg-slate-800/30 border-slate-700/50 hover:bg-slate-800 text-slate-400"}`,children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsx("span",{className:"font-black uppercase tracking-wider",children:l.action}),t.jsxs("span",{className:"opacity-40 text-[8px]",children:[l.steps.length," steps"]})]}),t.jsx("div",{className:"text-[9px] opacity-60 truncate",children:l.steps[l.steps.length-1]?.message})]},l.id))]}),g==="wiki"&&t.jsxs("div",{className:"space-y-8 font-sans pb-12 text-slate-400",children:[t.jsx("h3",{className:"text-white font-black text-xs uppercase tracking-[0.3em]",children:"Knowledge Base"}),t.jsxs("section",{children:[t.jsx("h4",{className:"text-blue-400 font-bold text-sm mb-2 uppercase",children:n("btree:wiki.concept")}),t.jsx(S,{text:n("btree:wiki.conceptDesc")})]}),t.jsxs("section",{children:[t.jsx("h4",{className:"text-green-400 font-bold text-sm mb-2 uppercase",children:n("btree:wiki.properties")}),t.jsx(S,{text:n("btree:wiki.propertiesDesc")})]}),t.jsxs("section",{children:[t.jsx("h4",{className:"text-purple-400 font-bold text-sm mb-2 uppercase",children:n("btree:wiki.insertion")}),t.jsx(S,{text:n("btree:wiki.insertionDesc")})]}),t.jsxs("section",{children:[t.jsx("h4",{className:"text-amber-400 font-bold text-sm mb-2 uppercase",children:n("btree:wiki.deletion")}),t.jsx(S,{text:n("btree:wiki.deletionDesc")})]}),t.jsxs("section",{children:[t.jsx("h4",{className:"text-cyan-400 font-bold text-sm mb-2 uppercase",children:n("btree:wiki.complexity")}),t.jsx(S,{text:n("btree:wiki.complexityDesc")})]})]}),g==="tutorial"&&me()]})]}),k&&window.innerWidth>768&&t.jsx("div",{onMouseDown:ue,className:"absolute right-0 top-0 w-1.5 h-full cursor-col-resize z-[120] hover:bg-blue-500/50"})]}),t.jsxs("div",{className:"flex-grow flex flex-col min-w-0 h-full relative bg-white",children:[t.jsxs("div",{className:"flex-grow relative overflow-hidden bg-grid-slate-100",children:[t.jsx("button",{onClick:()=>I(!k),className:"absolute bottom-6 left-6 z-30 w-10 h-10 bg-slate-900 text-white rounded-2xl shadow-xl flex items-center justify-center hover:scale-110 active:scale-90 transition-all",children:k?t.jsx(J,{size:20}):t.jsx(we,{size:20})}),t.jsx("div",{className:"absolute top-6 left-6 z-20 pointer-events-none",children:H&&t.jsxs("div",{className:"bg-blue-600/90 backdrop-blur-md px-4 py-2 rounded-2xl text-white shadow-lg border border-blue-400 flex items-center gap-2 animate-in slide-in-from-left-4",children:[t.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-white animate-pulse shrink-0"}),t.jsx("span",{className:"text-xs font-black uppercase tracking-wider",children:H})]})}),t.jsx(ye,{initialScale:1,minScale:.1,maxScale:2,centerOnInit:!0,children:({zoomIn:l,zoomOut:d,resetTransform:b})=>{const v=Ee(h);return t.jsxs(t.Fragment,{children:[t.jsx(ke,{wrapperStyle:{width:"100%",height:"100%"},children:t.jsx("div",{className:"w-[4000px] h-[4000px] relative cursor-grab active:cursor-grabbing",children:t.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",style:{overflow:"visible"},children:v&&t.jsx(O,{node:v,highlightedIds:le,onKeyClick:pe})})})}),t.jsxs("div",{className:"absolute bottom-6 right-6 z-20 flex flex-col gap-2",children:[t.jsx("button",{onClick:()=>l(),className:"w-10 h-10 bg-white shadow-sm border border-slate-200 rounded-xl flex items-center justify-center text-slate-600 hover:bg-white active:scale-90",children:t.jsx(je,{size:20})}),t.jsx("button",{onClick:()=>d(),className:"w-10 h-10 bg-white shadow-sm border border-slate-200 rounded-xl flex items-center justify-center text-slate-600 hover:bg-white active:scale-90",children:t.jsx(ve,{size:20})}),t.jsx("button",{onClick:()=>b(),className:"w-10 h-10 bg-blue-600 text-white rounded-xl flex items-center justify-center shadow-lg active:scale-90 mt-2",children:t.jsx(Se,{size:20})})]})]})}})]}),t.jsxs("div",{className:"bg-white border-t border-slate-200 p-3 sm:p-4 flex flex-col lg:flex-row gap-4 lg:gap-4 items-stretch overflow-visible shadow-[0_-10px_40px_rgba(0,0,0,0.03)] z-[100]",children:[t.jsxs(F,{label:"Operations",className:"w-full lg:w-[320px]",children:[t.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-2 w-full",children:[t.jsxs("div",{className:"flex gap-2 items-center bg-white p-1 rounded-xl border border-slate-200 flex-grow overflow-hidden shadow-sm",children:[t.jsx("input",{value:E,onChange:l=>N(l.target.value),onKeyDown:l=>l.key==="Enter"&&q(),className:"flex-grow min-w-0 px-2 text-xs font-bold outline-none text-center",placeholder:"Val"}),t.jsx("button",{onClick:q,disabled:w,className:"px-4 py-1.5 bg-blue-600 text-white rounded-lg text-[11px] font-black shadow-md shrink-0 active:scale-95 transition-all",children:"INSERT"})]}),t.jsxs("button",{onClick:fe,disabled:w,className:"px-4 py-2.5 bg-red-600 text-white rounded-xl text-[11px] font-black shadow-lg flex items-center gap-2 active:scale-95 transition-all shrink-0",children:[t.jsx(Ne,{size:14})," DELETE"]})]}),t.jsxs("button",{onClick:xe,disabled:w,className:`w-full flex items-center justify-center gap-2 py-1.5 border border-dashed text-[10px] font-black rounded-lg transition-all uppercase tracking-widest ${y?"bg-red-600 border-red-600 text-white animate-bounce":"border-slate-200 text-slate-400 hover:bg-red-50 hover:text-red-500"}`,children:[t.jsx($e,{size:12,className:y?"animate-spin":""})," ",y?"Confirm Reset?":"Reset Playground"]})]}),t.jsx(F,{label:"Timeline",className:"flex-grow",metadata:`Step ${Math.max(0,x+1)} / ${f.length}`,children:t.jsx(Le,{isPlaying:w,isPaused:!w,onTogglePause:()=>w?C():Y(f.length,x),onGoToStep:M,currentStep:x,totalSteps:f.length,onUndo:()=>M(Math.max(0,x-1)),onRedo:()=>M(Math.min(f.length-1,x+1)),canUndo:x>0,canRedo:x<f.length-1,playbackSpeed:B,setPlaybackSpeed:re})}),t.jsx(F,{label:"Settings",className:"w-full lg:w-[150px] shrink-0",children:t.jsxs("div",{className:"flex items-center gap-2 h-full",children:[t.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Order"}),t.jsx("div",{className:"flex gap-1 flex-grow",children:[3,4,5].map(l=>t.jsx("button",{onClick:()=>A(l),className:`flex-1 h-8 rounded border text-xs font-bold transition-all ${e===l?"bg-blue-600 border-blue-600 text-white":"bg-slate-50 border-slate-200 text-slate-500 hover:bg-slate-100"}`,children:l},l))})]})})]})]})]})};export{Ue as BTreePage};
